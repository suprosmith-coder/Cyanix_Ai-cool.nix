<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cyanix AI - ChatGPT Alternative</title>
    
    <!-- PWA Configuration -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#0d0221">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Cyanix AI">
    <link rel="apple-touch-icon" href="/icons/icon-192x192.png">
    <meta name="description" content="Cyanix AI - Advanced ChatGPT-like AI assistant with secure authentication">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --cyan-primary: #00f3ff;
            --cyan-secondary: #00a8b5;
            --cyan-light: #6bffff;
            --purple-dark: #0d0221;
            --purple-deep: #1a0633;
            --gray-dark: #1e1e2e;
            --gray-medium: #2d2d3a;
            --gray-light: #f5f5f7;
            --white: #ffffff;
            --neon-glow: 0 0 10px var(--cyan-primary), 0 0 20px var(--cyan-primary), 0 0 30px var(--cyan-primary);
            --card-shadow: 0 8px 32px rgba(0, 243, 255, 0.1);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--purple-dark);
            color: var(--white);
            min-height: 100vh;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Splash Screen */
        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--purple-dark);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            animation: fadeOut 0.5s ease-out 2s forwards;
        }

        .splash-logo {
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, var(--cyan-secondary), var(--cyan-primary));
            border-radius: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            box-shadow: var(--neon-glow);
            margin-bottom: 30px;
            animation: pulse 2s infinite;
        }

        .splash-title {
            font-size: 36px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--cyan-primary), var(--cyan-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .splash-subtitle {
            font-size: 16px;
            color: var(--cyan-light);
            opacity: 0.8;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes fadeOut {
            to { opacity: 0; visibility: hidden; }
        }

        /* Auth Container */
        .auth-container {
            display: flex;
            min-height: 100vh;
            overflow-y: auto;
        }

        .auth-left {
            flex: 1;
            background: linear-gradient(135deg, var(--purple-dark), var(--purple-deep));
            padding: 60px 40px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            position: relative;
            overflow: hidden;
            min-height: 100vh;
        }

        .auth-left::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 20% 80%, rgba(0, 243, 255, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, rgba(157, 78, 221, 0.1) 0%, transparent 50%);
        }

        .auth-right {
            flex: 1;
            background: var(--gray-dark);
            padding: 60px 40px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            min-height: 100vh;
        }

        .auth-logo {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 40px;
        }

        .logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--cyan-secondary), var(--cyan-primary));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: var(--neon-glow);
        }

        .logo-text {
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--cyan-primary), var(--cyan-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .auth-title {
            font-size: 42px;
            font-weight: 700;
            margin-bottom: 15px;
            line-height: 1.2;
        }

        .auth-subtitle {
            font-size: 18px;
            color: var(--cyan-light);
            opacity: 0.8;
            margin-bottom: 40px;
        }

        .features-list {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 40px;
        }

        .feature-item {
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--cyan-light);
            font-size: 14px;
        }

        .feature-icon {
            color: var(--cyan-primary);
            font-size: 20px;
        }

        /* Auth Forms */
        .auth-form {
            max-width: 400px;
            margin: 0 auto;
            width: 100%;
        }

        .auth-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 40px;
            background: var(--gray-medium);
            padding: 6px;
            border-radius: 12px;
        }

        .auth-tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            background: transparent;
            border: none;
            color: var(--white);
            font-size: 16px;
            font-weight: 500;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
        }

        .auth-tab.active {
            background: var(--cyan-primary);
            color: var(--purple-dark);
            box-shadow: var(--neon-glow);
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px;
            color: var(--cyan-light);
        }

        .form-input {
            width: 100%;
            padding: 16px;
            background: var(--gray-medium);
            border: 2px solid transparent;
            border-radius: 12px;
            font-size: 16px;
            color: var(--white);
            transition: var(--transition);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--cyan-primary);
            box-shadow: 0 0 0 3px rgba(0, 243, 255, 0.1);
        }

        .form-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .password-toggle {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--cyan-light);
            cursor: pointer;
        }

        .password-wrapper {
            position: relative;
        }

        .form-options {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .remember-me {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: var(--cyan-light);
        }

        .checkbox {
            width: 18px;
            height: 18px;
            border: 2px solid var(--cyan-primary);
            border-radius: 4px;
            cursor: pointer;
        }

        .forgot-password {
            color: var(--cyan-primary);
            text-decoration: none;
            font-size: 14px;
            transition: var(--transition);
        }

        .forgot-password:hover {
            text-decoration: underline;
        }

        .auth-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, var(--cyan-secondary), var(--cyan-primary));
            color: var(--purple-dark);
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            margin-bottom: 30px;
            box-shadow: var(--neon-glow);
        }

        .auth-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 30px rgba(0, 243, 255, 0.4);
        }

        .auth-btn:active {
            transform: translateY(0);
        }

        .auth-divider {
            display: flex;
            align-items: center;
            margin: 30px 0;
            color: var(--cyan-light);
            font-size: 14px;
        }

        .auth-divider::before,
        .auth-divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--gray-medium);
        }

        .auth-divider span {
            padding: 0 20px;
        }

        .social-auth {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 30px;
        }

        .social-btn {
            padding: 16px;
            background: var(--gray-medium);
            border: 2px solid transparent;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            font-size: 18px;
            color: var(--white);
        }

        .social-btn:hover {
            border-color: var(--cyan-primary);
            transform: translateY(-2px);
        }

        .google-btn {
            color: #4285F4;
        }

        .microsoft-btn {
            color: #00A4EF;
        }

        .email-btn {
            color: var(--cyan-primary);
        }

        .auth-footer {
            text-align: center;
            color: var(--cyan-light);
            font-size: 14px;
            padding: 20px 0;
        }

        .auth-footer a {
            color: var(--cyan-primary);
            text-decoration: none;
            font-weight: 500;
        }

        .auth-footer a:hover {
            text-decoration: underline;
        }

        /* Terms Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            padding: 20px;
        }

        .modal-overlay.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        .modal {
            background: var(--gray-dark);
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: var(--card-shadow);
            border: 2px solid var(--cyan-primary);
        }

        .modal-header {
            margin-bottom: 30px;
        }

        .modal-title {
            font-size: 24px;
            font-weight: 600;
            color: var(--white);
            margin-bottom: 10px;
        }

        .modal-subtitle {
            color: var(--cyan-light);
            font-size: 14px;
            opacity: 0.8;
        }

        .modal-content {
            color: var(--cyan-light);
            line-height: 1.6;
            margin-bottom: 30px;
        }

        .modal-content p {
            margin-bottom: 15px;
        }

        .modal-footer {
            display: flex;
            gap: 12px;
        }

        .modal-btn {
            flex: 1;
            padding: 15px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
        }

        .modal-btn.primary {
            background: var(--cyan-primary);
            color: var(--purple-dark);
            border: none;
        }

        .modal-btn.secondary {
            background: transparent;
            color: var(--cyan-light);
            border: 2px solid var(--gray-medium);
        }

        /* Chat Interface */
        .chat-container {
            display: none;
            height: 100vh;
            position: relative;
            overflow: hidden;
        }

        .chat-container.active {
            display: block;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 260px;
            height: 100%;
            background: var(--purple-deep);
            border-right: 1px solid rgba(0, 243, 255, 0.1);
            display: flex;
            flex-direction: column;
            z-index: 100;
            transform: translateX(-100%);
            transition: transform 0.3s ease;
        }

        .sidebar.active {
            transform: translateX(0);
        }

        .sidebar-header {
            padding: 25px 20px;
            border-bottom: 1px solid rgba(0, 243, 255, 0.1);
        }

        .sidebar-logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .sidebar-logo-icon {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, var(--cyan-secondary), var(--cyan-primary));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            box-shadow: var(--neon-glow);
        }

        .sidebar-logo-text {
            font-size: 20px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--cyan-primary), var(--cyan-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .sidebar-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .new-chat-btn {
            width: 100%;
            padding: 14px;
            background: var(--cyan-primary);
            color: var(--purple-dark);
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: var(--neon-glow);
        }

        .new-chat-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 25px rgba(0, 243, 255, 0.4);
        }

        .history-section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--cyan-light);
            opacity: 0.7;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 15px;
        }

        .conversation-list {
            list-style: none;
        }

        .conversation-item {
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
            color: var(--cyan-light);
        }

        .conversation-item:hover {
            background: rgba(0, 243, 255, 0.1);
        }

        .conversation-item.active {
            background: rgba(0, 243, 255, 0.2);
            color: var(--cyan-primary);
        }

        .conversation-icon {
            font-size: 18px;
        }

        .conversation-text {
            flex: 1;
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid rgba(0, 243, 255, 0.1);
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
        }

        .user-profile:hover {
            background: rgba(0, 243, 255, 0.1);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--cyan-secondary), var(--cyan-primary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: var(--purple-dark);
            font-size: 16px;
        }

        .user-info {
            flex: 1;
        }

        .user-name {
            font-size: 14px;
            font-weight: 500;
            color: var(--white);
            margin-bottom: 2px;
        }

        .user-email {
            font-size: 12px;
            color: var(--cyan-light);
            opacity: 0.7;
        }

        .user-menu-btn {
            background: none;
            border: none;
            color: var(--cyan-light);
            cursor: pointer;
            font-size: 18px;
        }

        /* Main Chat Area */
        .main-chat {
            margin-left: 0;
            height: 100%;
            display: flex;
            flex-direction: column;
            transition: margin-left 0.3s ease;
        }

        .main-chat.sidebar-active {
            margin-left: 260px;
        }

        .chat-header {
            padding: 20px;
            background: rgba(13, 2, 33, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(0, 243, 255, 0.1);
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .menu-toggle {
            background: none;
            border: none;
            color: var(--cyan-primary);
            font-size: 24px;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            transition: var(--transition);
        }

        .menu-toggle:hover {
            background: rgba(0, 243, 255, 0.1);
        }

        .chat-title {
            flex: 1;
            font-size: 18px;
            font-weight: 600;
            color: var(--white);
        }

        .chat-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .header-btn {
            width: 40px;
            height: 40px;
            background: rgba(0, 243, 255, 0.1);
            border: none;
            border-radius: 8px;
            color: var(--cyan-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: var(--transition);
        }

        .header-btn:hover {
            background: rgba(0, 243, 255, 0.2);
        }

        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 40px 20px;
            background: var(--purple-dark);
        }

        .welcome-screen {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
            padding-top: 60px;
        }

        .welcome-icon {
            font-size: 64px;
            margin-bottom: 30px;
            background: linear-gradient(135deg, var(--cyan-secondary), var(--cyan-primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .welcome-title {
            font-size: 48px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--cyan-primary), var(--cyan-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
        }

        .welcome-subtitle {
            font-size: 18px;
            color: var(--cyan-light);
            opacity: 0.8;
            max-width: 600px;
            margin: 0 auto 40px;
            line-height: 1.6;
        }

        .example-prompts {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            max-width: 600px;
            margin: 40px auto;
        }

        .example-prompt {
            padding: 20px;
            background: rgba(0, 243, 255, 0.05);
            border: 1px solid rgba(0, 243, 255, 0.1);
            border-radius: 12px;
            text-align: left;
            cursor: pointer;
            transition: var(--transition);
        }

        .example-prompt:hover {
            background: rgba(0, 243, 255, 0.1);
            transform: translateY(-2px);
        }

        .example-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--cyan-primary);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .example-text {
            font-size: 14px;
            color: var(--cyan-light);
            opacity: 0.9;
        }

        .message {
            max-width: 800px;
            margin: 0 auto 30px;
            padding: 20px;
            animation: messageAppear 0.3s ease;
        }

        .message.user {
            background: linear-gradient(135deg, rgba(0, 243, 255, 0.1), rgba(0, 168, 181, 0.05));
            border-radius: 18px;
            border: 1px solid rgba(0, 243, 255, 0.2);
        }

        .message.assistant {
            background: rgba(0, 243, 255, 0.03);
            border-radius: 18px;
            border: 1px solid rgba(0, 243, 255, 0.1);
        }

        .message-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
        }

        .message-avatar.user {
            background: linear-gradient(135deg, var(--cyan-secondary), var(--cyan-primary));
            color: var(--purple-dark);
        }

        .message-avatar.assistant {
            background: linear-gradient(135deg, #9d4edd, #5a189a);
            color: var(--white);
        }

        .message-sender {
            font-size: 14px;
            font-weight: 600;
            color: var(--white);
        }

        .message-time {
            font-size: 12px;
            color: var(--cyan-light);
            opacity: 0.7;
            margin-left: auto;
        }

        .message-content {
            font-size: 16px;
            line-height: 1.6;
            color: var(--cyan-light);
        }

        .message-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .message:hover .message-actions {
            opacity: 1;
        }

        .message-action {
            background: none;
            border: none;
            color: var(--cyan-light);
            cursor: pointer;
            font-size: 16px;
            padding: 6px;
            border-radius: 6px;
            transition: var(--transition);
        }

        .message-action:hover {
            background: rgba(0, 243, 255, 0.1);
            color: var(--cyan-primary);
        }

        .typing-indicator {
            max-width: 800px;
            margin: 0 auto 30px;
            padding: 20px;
            background: rgba(0, 243, 255, 0.03);
            border-radius: 18px;
            border: 1px solid rgba(0, 243, 255, 0.1);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .typing-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #9d4edd, #5a189a);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 14px;
            font-weight: 600;
        }

        .typing-dots {
            display: flex;
            gap: 8px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--cyan-primary);
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        .input-container {
            padding: 20px;
            background: rgba(13, 2, 33, 0.95);
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(0, 243, 255, 0.1);
        }

        .input-wrapper {
            max-width: 800px;
            margin: 0 auto;
            position: relative;
        }

        .chat-input {
            width: 100%;
            min-height: 56px;
            max-height: 200px;
            padding: 16px 70px 16px 20px;
            background: rgba(0, 243, 255, 0.05);
            border: 2px solid rgba(0, 243, 255, 0.2);
            border-radius: 16px;
            font-size: 16px;
            color: var(--white);
            resize: none;
            transition: var(--transition);
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--cyan-primary);
            box-shadow: 0 0 0 3px rgba(0, 243, 255, 0.1);
        }

        .chat-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .input-buttons {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            gap: 10px;
        }

        .input-btn {
            width: 40px;
            height: 40px;
            background: rgba(0, 243, 255, 0.1);
            border: none;
            border-radius: 50%;
            color: var(--cyan-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: var(--transition);
        }

        .input-btn:hover {
            background: rgba(0, 243, 255, 0.2);
        }

        .input-btn.send {
            background: linear-gradient(135deg, var(--cyan-secondary), var(--cyan-primary));
            color: var(--purple-dark);
            box-shadow: var(--neon-glow);
        }

        .input-btn.send:hover {
            transform: scale(1.1);
        }

        .input-btn.send:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* User Menu */
        .user-menu {
            position: fixed;
            bottom: 80px;
            left: 20px;
            background: var(--purple-deep);
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(0, 243, 255, 0.1);
            min-width: 200px;
            z-index: 1000;
            display: none;
        }

        .user-menu.active {
            display: block;
            animation: slideUp 0.3s ease;
        }

        .menu-item {
            padding: 16px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--cyan-light);
            cursor: pointer;
            transition: var(--transition);
            border-bottom: 1px solid rgba(0, 243, 255, 0.1);
        }

        .menu-item:last-child {
            border-bottom: none;
        }

        .menu-item:hover {
            background: rgba(0, 243, 255, 0.1);
            color: var(--cyan-primary);
        }

        .menu-item.danger {
            color: #ff4757;
        }

        .menu-item.danger:hover {
            background: rgba(255, 71, 87, 0.1);
        }

        /* Settings Styles */
        .settings-group {
            margin-bottom: 25px;
        }

        .settings-option {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: rgba(0, 243, 255, 0.05);
            border-radius: 12px;
            margin-bottom: 10px;
            border: 1px solid rgba(0, 243, 255, 0.1);
        }

        .option-label {
            font-weight: 500;
            color: var(--white);
            margin-bottom: 4px;
        }

        .option-description {
            font-size: 12px;
            color: var(--cyan-light);
            opacity: 0.7;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--gray-medium);
            transition: .4s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--cyan-primary);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }

        .form-range {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: var(--gray-medium);
            outline: none;
            -webkit-appearance: none;
            margin: 10px 0;
        }

        .form-range::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--cyan-primary);
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0, 243, 255, 0.5);
        }

        /* API Status Indicator */
        .api-status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            padding: 6px 12px;
            border-radius: 12px;
            background: rgba(0, 243, 255, 0.1);
            border: 1px solid rgba(0, 243, 255, 0.2);
            cursor: pointer;
            transition: var(--transition);
            user-select: none;
        }

        .api-status:hover {
            background: rgba(0, 243, 255, 0.2);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .status-dot.online {
            background: #2ed573;
            box-shadow: 0 0 10px #2ed573;
        }

        .status-dot.offline {
            background: #ff4757;
        }

        .status-dot.loading {
            background: #ffa502;
            animation: pulse 1s infinite;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .auth-container {
                flex-direction: column;
                overflow-y: auto;
            }

            .auth-left,
            .auth-right {
                padding: 40px 20px;
                min-height: auto;
                height: auto;
            }

            .auth-left {
                padding-bottom: 60px;
            }

            .auth-right {
                padding-top: 60px;
            }

            .features-list {
                grid-template-columns: 1fr;
            }

            .sidebar {
                width: 100%;
                transform: translateX(-100%);
            }

            .main-chat.sidebar-active {
                margin-left: 0;
            }

            .example-prompts {
                grid-template-columns: 1fr;
            }

            .welcome-title {
                font-size: 32px;
            }

            .welcome-subtitle {
                font-size: 16px;
            }

            .auth-title {
                font-size: 32px;
            }

            .auth-subtitle {
                font-size: 16px;
            }
            
            .chat-actions {
                gap: 5px;
            }
            
            .api-status {
                padding: 4px 8px;
                font-size: 11px;
            }
        }

        /* Animations */
        @keyframes messageAppear {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 0.7;
            }
            30% {
                transform: translateY(-10px);
                opacity: 1;
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Toast Styles */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 24px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 10000;
            animation: slideIn 0.3s ease, slideOut 0.3s ease 2.7s forwards;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            max-width: 400px;
            word-wrap: break-word;
        }

        .toast.success {
            background: #2ed573;
        }

        .toast.error {
            background: #ff4757;
        }

        .toast.info {
            background: #3742fa;
        }

        .toast.warning {
            background: #ffa502;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        /* Code block styles */
        code {
            background: rgba(0, 243, 255, 0.1);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            border: 1px solid rgba(0, 243, 255, 0.2);
        }

        pre {
            background: rgba(0, 243, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 10px 0;
            border: 1px solid rgba(0, 243, 255, 0.1);
        }

        pre code {
            background: transparent;
            padding: 0;
            border: none;
            font-size: 14px;
            line-height: 1.5;
        }

        /* Markdown Styles */
        .message-content h1,
        .message-content h2,
        .message-content h3 {
            margin-top: 20px;
            margin-bottom: 10px;
            color: var(--cyan-light);
        }

        .message-content h1 {
            font-size: 24px;
        }

        .message-content h2 {
            font-size: 20px;
        }

        .message-content h3 {
            font-size: 18px;
        }

        .message-content ul,
        .message-content ol {
            margin-left: 20px;
            margin-bottom: 15px;
        }

        .message-content li {
            margin-bottom: 5px;
        }

        .message-content blockquote {
            border-left: 4px solid var(--cyan-primary);
            padding-left: 15px;
            margin: 15px 0;
            color: var(--cyan-light);
            opacity: 0.9;
            font-style: italic;
        }

        .message-content table {
            border-collapse: collapse;
            width: 100%;
            margin: 15px 0;
        }

        .message-content th,
        .message-content td {
            border: 1px solid rgba(0, 243, 255, 0.2);
            padding: 8px 12px;
            text-align: left;
        }

        .message-content th {
            background: rgba(0, 243, 255, 0.1);
        }

        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(13, 2, 33, 0.95);
            backdrop-filter: blur(10px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            flex-direction: column;
            gap: 20px;
        }

        .loading-overlay.active {
            display: flex;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(0, 243, 255, 0.1);
            border-top: 3px solid var(--cyan-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Error Message Styles */
        .error-message {
            background: rgba(255, 71, 87, 0.1);
            border: 1px solid rgba(255, 71, 87, 0.3);
            border-radius: 12px;
            padding: 15px;
            margin: 10px 0;
            color: #ff4757;
            font-size: 14px;
        }

        .error-message .error-title {
            font-weight: 600;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Connection Status */
        .connection-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 500;
            z-index: 1000;
            background: rgba(0, 243, 255, 0.1);
            border: 1px solid rgba(0, 243, 255, 0.2);
            display: none;
        }

        .connection-status.online {
            background: rgba(46, 213, 115, 0.1);
            border-color: rgba(46, 213, 115, 0.3);
            color: #2ed573;
        }

        .connection-status.offline {
            background: rgba(255, 71, 87, 0.1);
            border-color: rgba(255, 71, 87, 0.3);
            color: #ff4757;
        }
    </style>
</head>
<body>
    <!-- Splash Screen -->
    <div id="splashScreen" class="splash-screen">
        <div class="splash-logo">
            <i class="fas fa-robot"></i>
        </div>
        <h1 class="splash-title">Cyanix AI</h1>
        <p class="splash-subtitle">Loading your AI assistant...</p>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner"></div>
        <p id="loadingText">Processing your request...</p>
    </div>

    <!-- Connection Status -->
    <div id="connectionStatus" class="connection-status"></div>

    <!-- Auth Container -->
    <div id="authContainer" class="auth-container">
        <div class="auth-left">
            <div class="auth-logo">
                <div class="logo-icon">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="logo-text">Cyanix AI</div>
            </div>
            
            <h1 class="auth-title">Welcome to the Future of AI Conversation</h1>
            <p class="auth-subtitle">Experience ChatGPT-level intelligence with enhanced privacy and control</p>
            
            <div class="features-list">
                <div class="feature-item">
                    <i class="fas fa-bolt feature-icon"></i>
                    <span>Instant Responses</span>
                </div>
                <div class="feature-item">
                    <i class="fas fa-shield-alt feature-icon"></i>
                    <span>End-to-End Encryption</span>
                </div>
                <div class="feature-item">
                    <i class="fas fa-history feature-icon"></i>
                    <span>Unlimited Conversation History</span>
                </div>
                <div class="feature-item">
                    <i class="fas fa-mobile-alt feature-icon"></i>
                    <span>Cross-Platform Sync</span>
                </div>
                <div class="feature-item">
                    <i class="fas fa-code feature-icon"></i>
                    <span>Code Execution Support</span>
                </div>
                <div class="feature-item">
                    <i class="fas fa-file-export feature-icon"></i>
                    <span>Export Conversations</span>
                </div>
            </div>
        </div>
        
        <div class="auth-right">
            <div class="auth-form" id="authForm">
                <div class="auth-tabs">
                    <button class="auth-tab active" onclick="switchAuthTab('signin')">Sign In</button>
                    <button class="auth-tab" onclick="switchAuthTab('signup')">Sign Up</button>
                </div>
                
                <!-- Sign In Form -->
                <div id="signinForm" class="auth-form-content">
                    <div class="form-group">
                        <label class="form-label">Email Address</label>
                        <input type="email" id="signinEmail" class="form-input" placeholder="Enter your email" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <div class="password-wrapper">
                            <input type="password" id="signinPassword" class="form-input" placeholder="Enter your password" required>
                            <button class="password-toggle" type="button" onclick="togglePassword('signinPassword')">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="form-options">
                        <label class="remember-me">
                            <input type="checkbox" id="rememberMe" class="checkbox">
                            <span>Remember me</span>
                        </label>
                        <a href="#" class="forgot-password" onclick="showForgotPassword()">Forgot Password?</a>
                    </div>
                    
                    <button class="auth-btn" onclick="signInWithEmail()" id="signinBtn">Sign In</button>
                    
                    <div class="auth-divider">
                        <span>Or continue with</span>
                    </div>
                    
                    <div class="social-auth">
                        <button class="social-btn google-btn" onclick="signInWithGoogle()">
                            <i class="fab fa-google"></i>
                        </button>
                        <button class="social-btn microsoft-btn" onclick="signInWithMicrosoft()">
                            <i class="fab fa-microsoft"></i>
                        </button>
                        <button class="social-btn email-btn" onclick="signInWithEmail()">
                            <i class="fas fa-envelope"></i>
                        </button>
                    </div>
                    
                    <p class="auth-footer">
                        Don't have an account? <a href="#" onclick="switchAuthTab('signup')">Sign Up</a>
                    </p>
                </div>
                
                <!-- Sign Up Form -->
                <div id="signupForm" class="auth-form-content" style="display: none;">
                    <div class="form-group">
                        <label class="form-label">Full Name</label>
                        <input type="text" id="signupName" class="form-input" placeholder="Enter your full name" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Email Address</label>
                        <input type="email" id="signupEmail" class="form-input" placeholder="Enter your email" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <div class="password-wrapper">
                            <input type="password" id="signupPassword" class="form-input" placeholder="Create a password" required minlength="8">
                            <button class="password-toggle" type="button" onclick="togglePassword('signupPassword')">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Confirm Password</label>
                        <div class="password-wrapper">
                            <input type="password" id="signupConfirmPassword" class="form-input" placeholder="Confirm your password" required minlength="8">
                            <button class="password-toggle" type="button" onclick="togglePassword('signupConfirmPassword')">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="remember-me">
                            <input type="checkbox" id="acceptTerms" class="checkbox" required>
                            <span>I agree to the <a href="#" class="forgot-password" onclick="showTermsModal()">Terms & Privacy</a></span>
                        </label>
                    </div>
                    
                    <button class="auth-btn" onclick="signUpWithEmail()" id="signupBtn">Create Account</button>
                    
                    <div class="auth-divider">
                        <span>Or sign up with</span>
                    </div>
                    
                    <div class="social-auth">
                        <button class="social-btn google-btn" onclick="signUpWithGoogle()">
                            <i class="fab fa-google"></i>
                        </button>
                        <button class="social-btn microsoft-btn" onclick="signUpWithMicrosoft()">
                            <i class="fab fa-microsoft"></i>
                        </button>
                        <button class="social-btn email-btn" onclick="signUpWithEmail()">
                            <i class="fas fa-envelope"></i>
                        </button>
                    </div>
                    
                    <p class="auth-footer">
                        Already have an account? <a href="#" onclick="switchAuthTab('signin')">Sign In</a>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Terms & Privacy Modal -->
    <div id="termsModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Terms & Privacy Policy</h2>
                <p class="modal-subtitle">Last updated: January 2024</p>
            </div>
            <div class="modal-content">
                <p>By using Cyanix AI, you agree to our terms and privacy policy.</p>
                <p><strong>Data Privacy:</strong> We encrypt all your conversations end-to-end. Your data never leaves your device unless you explicitly choose to sync across devices.</p>
                <p><strong>Usage Policy:</strong> You agree to use Cyanix AI responsibly and not for any illegal activities, harassment, or generating harmful content.</p>
                <p><strong>Intellectual Property:</strong> You retain all rights to the content you create with Cyanix AI. We claim no ownership over your generated content.</p>
                <p><strong>Service Availability:</strong> We strive for 99.9% uptime but cannot guarantee uninterrupted service.</p>
                <p><strong>Changes to Terms:</strong> We may update these terms periodically. Continued use after changes constitutes acceptance.</p>
            </div>
            <div class="modal-footer">
                <button class="modal-btn secondary" onclick="hideTermsModal()">Cancel</button>
                <button class="modal-btn primary" onclick="acceptTerms()">I Accept</button>
            </div>
        </div>
    </div>

    <!-- Forgot Password Modal -->
    <div id="forgotPasswordModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Reset Password</h2>
                <p class="modal-subtitle">Enter your email to receive reset instructions</p>
            </div>
            <div class="modal-content">
                <div class="form-group">
                    <label class="form-label">Email Address</label>
                    <input type="email" id="resetEmail" class="form-input" placeholder="Enter your email" required>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn secondary" onclick="hideForgotPassword()">Cancel</button>
                <button class="modal-btn primary" onclick="sendResetEmail()">Send Reset Link</button>
            </div>
        </div>
    </div>

    <!-- AI Settings Modal -->
    <div id="aiSettingsModal" class="modal-overlay">
        <div class="modal" style="max-width: 500px;">
            <div class="modal-header">
                <h2 class="modal-title">AI Settings</h2>
                <p class="modal-subtitle">Configure OpenAI API and AI model settings</p>
            </div>
            <div class="modal-content">
                <div class="settings-group">
                    <div class="settings-option">
                        <div>
                            <div class="option-label">Use OpenAI API</div>
                            <div class="option-description">Enable to use real AI responses via OpenAI</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="useOpenAICheckbox" onchange="toggleApiKeyField()">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <div id="apiKeySection" style="display: none; margin-top: 20px;">
                    <div class="form-group">
                        <label class="form-label">OpenAI API Key</label>
                        <input type="password" id="apiKeyInput" class="form-input" placeholder="sk-...">
                        <p style="font-size: 12px; color: var(--cyan-light); opacity: 0.7; margin-top: 5px;">
                            Your API key is stored locally in your browser. Get your key from 
                            <a href="https://platform.openai.com/api-keys" target="_blank" style="color: var(--cyan-primary);">OpenAI Dashboard</a>
                        </p>
                    </div>
                </div>

                <div class="settings-group" style="margin-top: 20px;">
                    <div class="form-group">
                        <label class="form-label">AI Model</label>
                        <select id="aiModelSelect" class="form-input">
                            <option value="gpt-3.5-turbo">GPT-3.5 Turbo (Fast & Cost-effective)</option>
                            <option value="gpt-4">GPT-4 (More Capable)</option>
                            <option value="gpt-4-turbo">GPT-4 Turbo (Latest)</option>
                            <option value="gpt-4o">GPT-4o (Optimized)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            Temperature: <span id="temperatureValue">0.7</span>
                            <span style="font-size: 12px; color: var(--cyan-light); opacity: 0.7; margin-left: 10px;">
                                (Higher = more creative, Lower = more focused)
                            </span>
                        </label>
                        <input type="range" id="temperatureRange" class="form-range" min="0" max="2" step="0.1" 
                               oninput="document.getElementById('temperatureValue').textContent = this.value">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Max Response Tokens</label>
                        <input type="number" id="maxTokensInput" class="form-input" min="100" max="4000" value="1000">
                        <p style="font-size: 12px; color: var(--cyan-light); opacity: 0.7; margin-top: 5px;">
                            Maximum length of AI responses (approx. 750 tokens = 1000 words)
                        </p>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Response Speed</label>
                        <select id="responseSpeed" class="form-input">
                            <option value="fast">Fast (Prioritize speed)</option>
                            <option value="balanced" selected>Balanced (Speed & quality)</option>
                            <option value="quality">Quality (Best responses)</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn secondary" onclick="hideAISettingsModal()">Cancel</button>
                <button class="modal-btn primary" onclick="saveAISettings()">Save Settings</button>
            </div>
        </div>
    </div>

    <!-- Chat Interface -->
    <div id="chatContainer" class="chat-container">
        <!-- Sidebar -->
        <div id="sidebar" class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <div class="sidebar-logo-icon">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="sidebar-logo-text">Cyanix AI</div>
                </div>
            </div>
            
            <div class="sidebar-content">
                <button class="new-chat-btn" onclick="newChat()">
                    <i class="fas fa-plus"></i>
                    New Chat
                </button>
                
                <div class="history-section">
                    <div class="section-title">Today</div>
                    <ul class="conversation-list" id="todayConversations">
                        <!-- Today's conversations will be added here -->
                    </ul>
                </div>
                
                <div class="history-section">
                    <div class="section-title">Yesterday</div>
                    <ul class="conversation-list" id="yesterdayConversations">
                        <!-- Yesterday's conversations will be added here -->
                    </ul>
                </div>
                
                <div class="history-section">
                    <div class="section-title">Previous 7 Days</div>
                    <ul class="conversation-list" id="weekConversations">
                        <!-- Week's conversations will be added here -->
                    </ul>
                </div>
            </div>
            
            <div class="sidebar-footer">
                <div class="user-profile" onclick="toggleUserMenu()">
                    <div class="user-avatar" id="userAvatar">U</div>
                    <div class="user-info">
                        <div class="user-name" id="userName">User</div>
                        <div class="user-email" id="userEmail">user@example.com</div>
                    </div>
                    <button class="user-menu-btn">
                        <i class="fas fa-chevron-down"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- User Menu -->
        <div id="userMenu" class="user-menu">
            <div class="menu-item" onclick="showProfile()">
                <i class="fas fa-user"></i>
                <span>Profile</span>
            </div>
            <div class="menu-item" onclick="showAISettings()">
                <i class="fas fa-brain"></i>
                <span>AI Settings</span>
            </div>
            <div class="menu-item" onclick="showSettings()">
                <i class="fas fa-cog"></i>
                <span>Settings</span>
            </div>
            <div class="menu-item" onclick="showUpgrade()">
                <i class="fas fa-crown"></i>
                <span>Upgrade to Pro</span>
            </div>
            <div class="menu-item" onclick="exportData()">
                <i class="fas fa-download"></i>
                <span>Export Data</span>
            </div>
            <div class="menu-item danger" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i>
                <span>Logout</span>
            </div>
        </div>
        
        <!-- Main Chat Area -->
        <div class="main-chat" id="mainChat">
            <div class="chat-header">
                <button class="menu-toggle" onclick="toggleSidebar()">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="chat-title" id="chatTitle">New Chat</div>
                <div class="chat-actions">
                    <div class="api-status" id="apiStatus" onclick="showAISettings()">
                        <div class="status-dot offline" id="statusDot"></div>
                        <span id="statusText">Offline</span>
                    </div>
                    <button class="header-btn" onclick="clearChat()">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                    <button class="header-btn" onclick="shareChat()">
                        <i class="fas fa-share-alt"></i>
                    </button>
                    <button class="header-btn" onclick="toggleDarkMode()">
                        <i class="fas fa-moon"></i>
                    </button>
                </div>
            </div>
            
            <div class="messages-container" id="messagesContainer">
                <!-- Welcome Screen -->
                <div id="welcomeScreen" class="welcome-screen">
                    <div class="welcome-icon">
                        <i class="fas fa-robot"></i>
                    </div>
                    <h1 class="welcome-title">How can I help you today?</h1>
                    <p class="welcome-subtitle">
                        I'm Cyanix AI, your intelligent assistant. I can help with writing, analysis, coding, 
                        creative tasks, and much more. What would you like to explore?
                    </p>
                    
                    <div class="example-prompts">
                        <div class="example-prompt" onclick="useExample('brainstorm')">
                            <div class="example-title">
                                <i class="fas fa-lightbulb"></i>
                                Brainstorm ideas
                            </div>
                            <div class="example-text">"Help me brainstorm creative project ideas for a tech startup"</div>
                        </div>
                        <div class="example-prompt" onclick="useExample('explain')">
                            <div class="example-title">
                                <i class="fas fa-book"></i>
                                Explain concepts
                            </div>
                            <div class="example-text">"Explain quantum computing in simple terms"</div>
                        </div>
                        <div class="example-prompt" onclick="useExample('code')">
                            <div class="example-title">
                                <i class="fas fa-code"></i>
                                Write code
                            </div>
                            <div class="example-text">"Write a Python function to sort a list using quicksort"</div>
                        </div>
                        <div class="example-prompt" onclick="useExample('analyze')">
                            <div class="example-title">
                                <i class="fas fa-chart-line"></i>
                                Analyze data
                            </div>
                            <div class="example-text">"Analyze the pros and cons of renewable energy sources"</div>
                        </div>
                    </div>
                </div>
                
                <!-- Messages will be inserted here -->
            </div>
            
            <div class="input-container">
                <div class="input-wrapper">
                    <textarea 
                        id="chatInput" 
                        class="chat-input" 
                        placeholder="Message Cyanix AI..."
                        rows="1"
                        oninput="autoResizeInput(this)"
                        onkeydown="handleKeyDown(event)"
                    ></textarea>
                    <div class="input-buttons">
                        <button class="input-btn" onclick="attachFile()">
                            <i class="fas fa-paperclip"></i>
                        </button>
                        <button class="input-btn" onclick="voiceInput()">
                            <i class="fas fa-microphone"></i>
                        </button>
                        <button class="input-btn send" id="sendButton" onclick="sendMessage()">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== APP STATE ====================
        let currentUser = null;
        let currentChatId = null;
        let conversations = [];
        let isSidebarOpen = false;
        let isDarkMode = true;
        let userMenuOpen = false;
        let isProcessingMessage = false;
        let retryCount = 0;
        const MAX_RETRIES = 3;

        // OpenAI Configuration
        let openaiApiKey = localStorage.getItem('openai_api_key') || '';
        let useOpenAI = localStorage.getItem('use_openai') === 'true';
        let aiModel = localStorage.getItem('ai_model') || 'gpt-3.5-turbo';
        let temperature = parseFloat(localStorage.getItem('temperature')) || 0.7;
        let maxTokens = parseInt(localStorage.getItem('max_tokens')) || 1000;
        let responseSpeed = localStorage.getItem('response_speed') || 'balanced';

        // Mock database for demo purposes
        const mockDatabase = {
            users: [],
            conversations: [],
            messages: []
        };

        // Enhanced mock responses with more variety
        const mockResponses = {
            greetings: [
                "Hello! I'm Cyanix AI, your intelligent assistant. How can I help you today?",
                "Hi there! I'm here to help with anything you need. What's on your mind?",
                "Greetings! Ready to dive into some interesting topics together?",
                "Welcome back! I'm ready to assist you with any questions or tasks you have."
            ],
            help: [
                `I can help you with a wide range of tasks including:

**Writing & Content Creation:**
 Blog posts, articles, and essays
 Creative writing and storytelling
 Marketing copy and advertisements
 Professional emails and letters
 Technical documentation

**Programming & Development:**
 Code generation in Python, JavaScript, Java, C++, Go, Rust, etc.
 Debugging and error fixing
 Algorithm explanations and optimizations
 API documentation
 Code reviews and best practices

**Research & Analysis:**
 Data analysis and interpretation
 Market research and competitive analysis
 Academic research and paper writing
 Statistical analysis
 Trend identification

**Creative Tasks:**
 Brainstorming ideas and concepts
 Creative project planning
 Design suggestions and feedback
 Art direction and creative strategy
 Brand development

**Learning & Education:**
 Concept explanations at any level
 Study guides and summaries
 Problem solving techniques
 Language learning assistance
 Curriculum planning

**Business & Productivity:**
 Business plan development
 Strategy formulation
 Productivity optimization
 Meeting preparation
 Decision analysis

What would you like to work on today?`
            ],
            coding: [
                `I specialize in coding assistance! I can help with:

**Languages I'm proficient in:**
 Python (including Django, Flask, Pandas, NumPy, TensorFlow, PyTorch)
 JavaScript/TypeScript (React, Vue, Angular, Node.js, Express)
 Java (Spring, Hibernate, Android)
 C++ (STL, Boost, Qt)
 C# (.NET, ASP.NET, Unity)
 Go, Rust, Swift, Kotlin, and more

**What I can do:**
 Write complete functions and classes
 Debug and fix errors in your code
 Explain complex algorithms
 Convert code between languages
 Write unit tests
 Optimize performance
 Generate API documentation
 Suggest architecture patterns

**Example:**
\`\`\`python
def quick_sort(arr):
    """
    Implementation of quicksort algorithm.
    Time Complexity: O(n log n) average, O(n) worst
    Space Complexity: O(log n)
    """
    if len(arr) <= 1:
        return arr
    pivot = arr[len(arr) // 2]
    left = [x for x in arr if x < pivot]
    middle = [x for x in arr if x == pivot]
    right = [x for x in arr if x > pivot]
    return quick_sort(left) + middle + quick_sort(right)

# Example usage:
numbers = [3, 6, 8, 10, 1, 2, 1]
sorted_numbers = quick_sort(numbers)
print(f"Sorted: {sorted_numbers}")
\`\`\`

What specific coding task do you need help with?`
            ],
            creative: [
                `Let's get creative! I can assist with:

**Content Creation:**
 Story writing (fiction, non-fiction, scripts)
 Poetry and creative writing
 Marketing campaigns and slogans
 Brand names and taglines
 Product descriptions
 Social media content

**Brainstorming & Ideation:**
 Startup ideas and business concepts
 Product innovation
 Problem-solving approaches
 Creative project development
 Artistic concepts and themes

**Design & Aesthetics:**
 UI/UX design suggestions
 Color scheme recommendations
 Layout and composition ideas
 Mood board concepts
 Creative direction

**Examples of creative assistance:**
1. "Help me write a short sci-fi story about AI ethics"
2. "Generate 10 creative names for a sustainable fashion brand"
3. "Create a marketing campaign for a new productivity app"
4. "Design a character for a fantasy novel"

What kind of creative project are you working on?`
            ],
            default: [
                `I understand you're asking about: "${placeholderMessage}"

Let me provide you with a comprehensive analysis.

**Key Insights:**
1. **Core Concept**: This topic revolves around fundamental principles that are crucial for understanding.
2. **Practical Applications**: There are numerous real-world applications worth exploring.
3. **Current Trends**: Recent developments have significantly impacted this field.
4. **Future Potential**: The future holds exciting possibilities for advancement.

**Detailed Analysis:**
Based on current knowledge and research, here's what you should know about this topic:

First, it's important to understand the foundational elements. These form the basis for more complex concepts and applications.

Next, consider the various approaches and methodologies. Different perspectives can provide valuable insights and alternative solutions.

Finally, implementation considerations are crucial. Practical application often requires careful planning and adaptation to specific contexts.

**Recommendations:**
1. Start with basic principles before advancing to complex topics
2. Explore multiple sources and perspectives
3. Consider both theoretical and practical aspects
4. Stay updated with latest developments in the field

Would you like me to elaborate on any specific aspect or provide more detailed examples?`
            ]
        };

        // Initialize app
        document.addEventListener('DOMContentLoaded', () => {
            initApp();
        });

        function initApp() {
            // Hide splash screen after delay
            setTimeout(() => {
                const splashScreen = document.getElementById('splashScreen');
                if (splashScreen) {
                    splashScreen.style.display = 'none';
                }
                
                // Check if user is already logged in
                const savedUser = localStorage.getItem('cyanix_user');
                if (savedUser) {
                    try {
                        currentUser = JSON.parse(savedUser);
                        showChatInterface();
                        loadConversations();
                    } catch (error) {
                        console.error('Error parsing saved user:', error);
                        localStorage.removeItem('cyanix_user');
                    }
                }
                
                // Update API status
                updateApiStatus();
                
                // Monitor online status
                window.addEventListener('online', updateConnectionStatus);
                window.addEventListener('offline', updateConnectionStatus);
                updateConnectionStatus();
            }, 2000);
            
            // Initialize form event listeners
            initializeAuthForms();
            
            // Load AI settings
            loadAISettings();
        }

        // ==================== CONNECTION STATUS ====================
        function updateConnectionStatus() {
            const statusElement = document.getElementById('connectionStatus');
            if (!statusElement) return;
            
            if (navigator.onLine) {
                statusElement.textContent = 'Online';
                statusElement.className = 'connection-status online';
            } else {
                statusElement.textContent = 'Offline - Check your connection';
                statusElement.className = 'connection-status offline';
            }
            
            // Show for 3 seconds then hide
            statusElement.style.display = 'block';
            setTimeout(() => {
                statusElement.style.display = 'none';
            }, 3000);
        }

        // ==================== AUTHENTICATION ====================
        function initializeAuthForms() {
            // Add enter key support for forms
            const signinEmail = document.getElementById('signinEmail');
            const signinPassword = document.getElementById('signinPassword');
            const signupEmail = document.getElementById('signupEmail');
            const signupPassword = document.getElementById('signupPassword');
            
            if (signinEmail && signinPassword) {
                signinEmail.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') signInWithEmail();
                });
                
                signinPassword.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') signInWithEmail();
                });
            }
            
            if (signupEmail && signupPassword) {
                signupEmail.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') signUpWithEmail();
                });
                
                signupPassword.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') signUpWithEmail();
                });
            }
        }

        function switchAuthTab(tab) {
            const signinTab = document.querySelector('[onclick="switchAuthTab(\'signin\')"]');
            const signupTab = document.querySelector('[onclick="switchAuthTab(\'signup\')"]');
            const signinForm = document.getElementById('signinForm');
            const signupForm = document.getElementById('signupForm');
            
            if (!signinTab || !signupTab || !signinForm || !signupForm) return;
            
            if (tab === 'signin') {
                signinTab.classList.add('active');
                signupTab.classList.remove('active');
                signinForm.style.display = 'block';
                signupForm.style.display = 'none';
            } else {
                signinTab.classList.remove('active');
                signupTab.classList.add('active');
                signinForm.style.display = 'none';
                signupForm.style.display = 'block';
            }
        }

        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            if (!input) return;
            
            const toggle = input.nextElementSibling?.querySelector('i');
            if (!toggle) return;
            
            if (input.type === 'password') {
                input.type = 'text';
                toggle.classList.remove('fa-eye');
                toggle.classList.add('fa-eye-slash');
            } else {
                input.type = 'password';
                toggle.classList.remove('fa-eye-slash');
                toggle.classList.add('fa-eye');
            }
        }

        function signInWithEmail() {
            const email = document.getElementById('signinEmail')?.value?.trim() || '';
            const password = document.getElementById('signinPassword')?.value || '';
            const rememberMe = document.getElementById('rememberMe')?.checked || false;
            const signinBtn = document.getElementById('signinBtn');
            
            if (!validateEmail(email)) {
                showToast('Please enter a valid email address', 'error');
                return;
            }
            
            if (password.length < 6) {
                showToast('Password must be at least 6 characters', 'error');
                return;
            }
            
            // Show loading
            if (signinBtn) {
                const originalText = signinBtn.textContent;
                signinBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Signing In...';
                signinBtn.disabled = true;
            }
            
            // Simulate API call
            setTimeout(() => {
                try {
                    // Check mock database or create new user
                    let user = mockDatabase.users.find(u => u.email === email);
                    
                    if (user && user.password === password) {
                        // Successful login
                        currentUser = {
                            id: user.id,
                            name: user.name,
                            email: user.email,
                            avatar: user.avatar,
                            plan: user.plan || 'free',
                            createdAt: user.createdAt
                        };
                        
                        // Save user session
                        if (rememberMe) {
                            localStorage.setItem('cyanix_user', JSON.stringify(currentUser));
                        } else {
                            sessionStorage.setItem('cyanix_user', JSON.stringify(currentUser));
                        }
                        
                        showChatInterface();
                        loadConversations();
                        showToast('Welcome back!', 'success');
                    } else {
                        showToast('Invalid email or password', 'error');
                    }
                } catch (error) {
                    console.error('Login error:', error);
                    showToast('An error occurred during login', 'error');
                } finally {
                    // Reset button
                    if (signinBtn) {
                        signinBtn.textContent = originalText || 'Sign In';
                        signinBtn.disabled = false;
                    }
                }
            }, 1500);
        }

        function signUpWithEmail() {
            const name = document.getElementById('signupName')?.value?.trim() || '';
            const email = document.getElementById('signupEmail')?.value?.trim() || '';
            const password = document.getElementById('signupPassword')?.value || '';
            const confirmPassword = document.getElementById('signupConfirmPassword')?.value || '';
            const acceptTerms = document.getElementById('acceptTerms')?.checked || false;
            const signupBtn = document.getElementById('signupBtn');
            
            // Validation
            if (!name) {
                showToast('Please enter your name', 'error');
                return;
            }
            
            if (!validateEmail(email)) {
                showToast('Please enter a valid email address', 'error');
                return;
            }
            
            if (password.length < 8) {
                showToast('Password must be at least 8 characters', 'error');
                return;
            }
            
            if (password !== confirmPassword) {
                showToast('Passwords do not match', 'error');
                return;
            }
            
            if (!acceptTerms) {
                showToast('Please accept the terms and privacy policy', 'error');
                return;
            }
            
            // Check if user already exists
            if (mockDatabase.users.some(u => u.email === email)) {
                showToast('An account with this email already exists', 'error');
                return;
            }
            
            // Show loading
            if (signupBtn) {
                const originalText = signupBtn.textContent;
                signupBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creating Account...';
                signupBtn.disabled = true;
            }
            
            // Simulate API call
            setTimeout(() => {
                try {
                    // Create new user
                    const newUser = {
                        id: 'user_' + Date.now(),
                        name: name,
                        email: email,
                        password: password,
                        avatar: getAvatarInitials(name),
                        plan: 'free',
                        createdAt: new Date().toISOString(),
                        provider: 'email'
                    };
                    
                    mockDatabase.users.push(newUser);
                    currentUser = { ...newUser };
                    delete currentUser.password;
                    
                    // Save user session
                    localStorage.setItem('cyanix_user', JSON.stringify(currentUser));
                    
                    showChatInterface();
                    showWelcomeMessage();
                    showToast('Account created successfully!', 'success');
                } catch (error) {
                    console.error('Signup error:', error);
                    showToast('An error occurred during signup', 'error');
                } finally {
                    // Reset button
                    if (signupBtn) {
                        signupBtn.textContent = originalText || 'Create Account';
                        signupBtn.disabled = false;
                    }
                }
            }, 2000);
        }

        function signInWithGoogle() {
            showToast('Redirecting to Google authentication...', 'info');
            
            setTimeout(() => {
                try {
                    // Simulate Google user data
                    const googleUser = {
                        id: 'google_' + Date.now(),
                        name: 'Demo User',
                        email: 'demo@example.com',
                        avatar: 'G',
                        plan: 'free',
                        provider: 'google'
                    };
                    
                    // Check if user exists
                    let user = mockDatabase.users.find(u => u.email === googleUser.email);
                    if (!user) {
                        user = {
                            ...googleUser,
                            createdAt: new Date().toISOString()
                        };
                        mockDatabase.users.push(user);
                    }
                    
                    currentUser = { ...user };
                    delete currentUser.password;
                    
                    localStorage.setItem('cyanix_user', JSON.stringify(currentUser));
                    showChatInterface();
                    loadConversations();
                    showToast('Signed in with Google', 'success');
                } catch (error) {
                    console.error('Google auth error:', error);
                    showToast('Google authentication failed', 'error');
                }
            }, 1500);
        }

        function signUpWithGoogle() {
            signInWithGoogle();
        }

        function signInWithMicrosoft() {
            showToast('Redirecting to Microsoft authentication...', 'info');
            
            setTimeout(() => {
                try {
                    // Simulate Microsoft user data
                    const microsoftUser = {
                        id: 'microsoft_' + Date.now(),
                        name: 'Business User',
                        email: 'business@example.com',
                        avatar: 'M',
                        plan: 'free',
                        provider: 'microsoft'
                    };
                    
                    // Check if user exists
                    let user = mockDatabase.users.find(u => u.email === microsoftUser.email);
                    if (!user) {
                        user = {
                            ...microsoftUser,
                            createdAt: new Date().toISOString()
                        };
                        mockDatabase.users.push(user);
                    }
                    
                    currentUser = { ...user };
                    delete currentUser.password;
                    
                    localStorage.setItem('cyanix_user', JSON.stringify(currentUser));
                    showChatInterface();
                    loadConversations();
                    showToast('Signed in with Microsoft', 'success');
                } catch (error) {
                    console.error('Microsoft auth error:', error);
                    showToast('Microsoft authentication failed', 'error');
                }
            }, 1500);
        }

        function signUpWithMicrosoft() {
            signInWithMicrosoft();
        }

        // ==================== AI SETTINGS ====================
        function loadAISettings() {
            try {
                openaiApiKey = localStorage.getItem('openai_api_key') || '';
                useOpenAI = localStorage.getItem('use_openai') === 'true';
                aiModel = localStorage.getItem('ai_model') || 'gpt-3.5-turbo';
                temperature = parseFloat(localStorage.getItem('temperature')) || 0.7;
                maxTokens = parseInt(localStorage.getItem('max_tokens')) || 1000;
                responseSpeed = localStorage.getItem('response_speed') || 'balanced';
            } catch (error) {
                console.error('Error loading AI settings:', error);
                // Reset to defaults
                openaiApiKey = '';
                useOpenAI = false;
                aiModel = 'gpt-3.5-turbo';
                temperature = 0.7;
                maxTokens = 1000;
                responseSpeed = 'balanced';
            }
        }

        function showAISettings() {
            try {
                // Update modal with current settings
                const aiModelSelect = document.getElementById('aiModelSelect');
                const temperatureRange = document.getElementById('temperatureRange');
                const temperatureValue = document.getElementById('temperatureValue');
                const maxTokensInput = document.getElementById('maxTokensInput');
                const useOpenAICheckbox = document.getElementById('useOpenAICheckbox');
                const apiKeyInput = document.getElementById('apiKeyInput');
                const responseSpeedSelect = document.getElementById('responseSpeed');
                
                if (aiModelSelect) aiModelSelect.value = aiModel;
                if (temperatureRange) temperatureRange.value = temperature;
                if (temperatureValue) temperatureValue.textContent = temperature;
                if (maxTokensInput) maxTokensInput.value = maxTokens;
                if (useOpenAICheckbox) useOpenAICheckbox.checked = useOpenAI;
                if (apiKeyInput) apiKeyInput.value = openaiApiKey;
                if (responseSpeedSelect) responseSpeedSelect.value = responseSpeed;
                
                // Show/hide API key field based on checkbox
                toggleApiKeyField();
                
                document.getElementById('aiSettingsModal').classList.add('active');
                toggleUserMenu();
            } catch (error) {
                console.error('Error showing AI settings:', error);
                showToast('Error loading AI settings', 'error');
            }
        }

        function hideAISettingsModal() {
            const modal = document.getElementById('aiSettingsModal');
            if (modal) {
                modal.classList.remove('active');
            }
        }

        function toggleApiKeyField() {
            const apiKeySection = document.getElementById('apiKeySection');
            const useOpenAICheckbox = document.getElementById('useOpenAICheckbox');
            
            if (apiKeySection && useOpenAICheckbox) {
                apiKeySection.style.display = useOpenAICheckbox.checked ? 'block' : 'none';
            }
        }

        function saveAISettings() {
            try {
                const useOpenAICheckbox = document.getElementById('useOpenAICheckbox');
                const aiModelSelect = document.getElementById('aiModelSelect');
                const temperatureRange = document.getElementById('temperatureRange');
                const maxTokensInput = document.getElementById('maxTokensInput');
                const apiKeyInput = document.getElementById('apiKeyInput');
                const responseSpeedSelect = document.getElementById('responseSpeed');
                
                if (!useOpenAICheckbox || !aiModelSelect || !temperatureRange || !maxTokensInput || !apiKeyInput || !responseSpeedSelect) {
                    throw new Error('Settings elements not found');
                }
                
                useOpenAI = useOpenAICheckbox.checked;
                aiModel = aiModelSelect.value;
                temperature = parseFloat(temperatureRange.value);
                maxTokens = parseInt(maxTokensInput.value);
                openaiApiKey = apiKeyInput.value.trim();
                responseSpeed = responseSpeedSelect.value;
                
                // Validation
                if (useOpenAI && !openaiApiKey.startsWith('sk-')) {
                    showToast('Please enter a valid OpenAI API key', 'error');
                    return;
                }
                
                if (temperature < 0 || temperature > 2) {
                    showToast('Temperature must be between 0 and 2', 'error');
                    return;
                }
                
                if (maxTokens < 100 || maxTokens > 4000) {
                    showToast('Max tokens must be between 100 and 4000', 'error');
                    return;
                }
                
                // Save to localStorage
                localStorage.setItem('use_openai', useOpenAI);
                localStorage.setItem('ai_model', aiModel);
                localStorage.setItem('temperature', temperature);
                localStorage.setItem('max_tokens', maxTokens);
                localStorage.setItem('openai_api_key', openaiApiKey);
                localStorage.setItem('response_speed', responseSpeed);
                
                showToast('AI settings saved successfully!', 'success');
                hideAISettingsModal();
                updateApiStatus();
            } catch (error) {
                console.error('Error saving AI settings:', error);
                showToast('Error saving settings: ' + error.message, 'error');
            }
        }

        function updateApiStatus() {
            const statusDot = document.getElementById('statusDot');
            const statusText = document.getElementById('statusText');
            
            if (!statusDot || !statusText) return;
            
            if (useOpenAI && openaiApiKey) {
                statusDot.className = 'status-dot online';
                statusText.textContent = 'OpenAI Ready';
            } else if (useOpenAI && !openaiApiKey) {
                statusDot.className = 'status-dot offline';
                statusText.textContent = 'No API Key';
            } else {
                statusDot.className = 'status-dot offline';
                statusText.textContent = 'Offline Mode';
            }
        }

        // ==================== OPENAI API INTEGRATION ====================
        async function generateAIResponseWithOpenAI(userMessage, conversationHistory = []) {
            if (!useOpenAI || !openaiApiKey) {
                throw new Error('OpenAI API not configured');
            }
            
            if (!navigator.onLine) {
                throw new Error('No internet connection');
            }
            
            try {
                const messages = [
                    {
                        role: "system",
                        content: `You are Cyanix AI, a helpful AI assistant created by Cyanix. Provide detailed, accurate, and helpful responses. 
                        Format your responses properly with markdown when appropriate. Use code blocks for code snippets with language specification.
                        Be concise when possible but provide thorough explanations when needed.
                        Current time: ${new Date().toLocaleString()}`
                    }
                ];
                
                // Add conversation history if available (last 10 messages)
                if (conversationHistory.length > 0) {
                    const recentHistory = conversationHistory.slice(-10);
                    recentHistory.forEach(msg => {
                        messages.push({
                            role: msg.sender === 'user' ? 'user' : 'assistant',
                            content: msg.content
                        });
                    });
                }
                
                // Add current user message
                messages.push({
                    role: "user",
                    content: userMessage
                });
                
                // Adjust parameters based on response speed setting
                let adjustedMaxTokens = maxTokens;
                let adjustedTemperature = temperature;
                
                switch (responseSpeed) {
                    case 'fast':
                        adjustedMaxTokens = Math.min(maxTokens, 500);
                        adjustedTemperature = Math.min(temperature, 0.5);
                        break;
                    case 'quality':
                        adjustedMaxTokens = Math.max(maxTokens, 1500);
                        adjustedTemperature = Math.min(temperature, 0.3);
                        break;
                    default:
                        // balanced - use default settings
                        break;
                }
                
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 30000); // 30 second timeout
                
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${openaiApiKey}`
                    },
                    body: JSON.stringify({
                        model: aiModel,
                        messages: messages,
                        temperature: adjustedTemperature,
                        max_tokens: adjustedMaxTokens,
                        stream: false
                    }),
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    let errorMessage = `API Error: ${response.status}`;
                    
                    if (errorData.error?.message) {
                        errorMessage = errorData.error.message;
                    } else if (response.status === 401) {
                        errorMessage = 'Invalid API key. Please check your AI settings.';
                    } else if (response.status === 429) {
                        errorMessage = 'Rate limit exceeded. Please try again later.';
                    } else if (response.status >= 500) {
                        errorMessage = 'OpenAI server error. Please try again.';
                    }
                    
                    throw new Error(errorMessage);
                }
                
                const data = await response.json();
                
                if (!data.choices || !data.choices[0] || !data.choices[0].message) {
                    throw new Error('Invalid response from OpenAI API');
                }
                
                return data.choices[0].message.content;
                
            } catch (error) {
                console.error('OpenAI API Error:', error);
                
                // Handle specific error types
                if (error.name === 'AbortError') {
                    throw new Error('Request timeout. Please try again.');
                } else if (error.message.includes('Failed to fetch')) {
                    throw new Error('Network error. Please check your connection.');
                } else if (error.message.includes('API key')) {
                    // Clear invalid API key
                    openaiApiKey = '';
                    localStorage.removeItem('openai_api_key');
                    updateApiStatus();
                    throw new Error('Invalid API key. Please update your AI settings.');
                }
                
                throw error;
            }
        }

        function generateMockAIResponse(userMessage) {
            // Categorize the user message
            let category = 'default';
            const lowerMessage = userMessage.toLowerCase();
            
            // Store for use in default response
            window.placeholderMessage = userMessage;

            if (lowerMessage.includes('hello') || lowerMessage.includes('hi') || lowerMessage.includes('hey') || lowerMessage.includes('greetings')) {
                category = 'greetings';
            } else if (lowerMessage.includes('help') || lowerMessage.includes('what can you do') || lowerMessage.includes('capabilities') || lowerMessage.includes('features')) {
                category = 'help';
            } else if (lowerMessage.match(/\b(code|program|python|javascript|java|c\+\+|html|css|react|node|sql|algorithm|function|debug|error)\b/)) {
                category = 'coding';
            } else if (lowerMessage.match(/\b(creative|write|story|idea|brainstorm|design|art|content|marketing|brand)\b/)) {
                category = 'creative';
            }

            const categoryResponses = mockResponses[category] || mockResponses.default;
            const response = categoryResponses[Math.floor(Math.random() * categoryResponses.length)];
            
            // Add processing time simulation
            return response;
        }

        // ==================== CHAT INTERFACE ====================
        function showChatInterface() {
            const authContainer = document.getElementById('authContainer');
            const chatContainer = document.getElementById('chatContainer');
            
            if (authContainer) authContainer.style.display = 'none';
            if (chatContainer) chatContainer.classList.add('active');
            
            // Update user info
            if (currentUser) {
                const userName = document.getElementById('userName');
                const userEmail = document.getElementById('userEmail');
                const userAvatar = document.getElementById('userAvatar');
                
                if (userName) userName.textContent = currentUser.name;
                if (userEmail) userEmail.textContent = currentUser.email;
                if (userAvatar) userAvatar.textContent = currentUser.avatar;
            }
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainChat = document.getElementById('mainChat');
            
            if (!sidebar || !mainChat) return;
            
            isSidebarOpen = !isSidebarOpen;
            
            if (isSidebarOpen) {
                sidebar.classList.add('active');
                mainChat.classList.add('sidebar-active');
            } else {
                sidebar.classList.remove('active');
                mainChat.classList.remove('sidebar-active');
            }
        }

        function toggleUserMenu() {
            const userMenu = document.getElementById('userMenu');
            if (!userMenu) return;
            
            userMenuOpen = !userMenuOpen;
            
            if (userMenuOpen) {
                userMenu.classList.add('active');
                // Close menu when clicking outside
                setTimeout(() => {
                    document.addEventListener('click', closeUserMenuOnClickOutside);
                }, 10);
            } else {
                userMenu.classList.remove('active');
                document.removeEventListener('click', closeUserMenuOnClickOutside);
            }
        }

        function closeUserMenuOnClickOutside(event) {
            const userMenu = document.getElementById('userMenu');
            const userProfile = document.querySelector('.user-profile');
            
            if (!userMenu || !userProfile) return;
            
            if (!userMenu.contains(event.target) && !userProfile.contains(event.target)) {
                userMenu.classList.remove('active');
                userMenuOpen = false;
                document.removeEventListener('click', closeUserMenuOnClickOutside);
            }
        }

        function newChat() {
            try {
                currentChatId = 'chat_' + Date.now();
                const messagesContainer = document.getElementById('messagesContainer');
                const chatTitle = document.getElementById('chatTitle');
                
                if (messagesContainer) messagesContainer.innerHTML = '';
                if (chatTitle) chatTitle.textContent = 'New Chat';
                
                // Show welcome screen
                const welcomeScreen = document.getElementById('welcomeScreen');
                if (welcomeScreen) {
                    const welcomeClone = welcomeScreen.cloneNode(true);
                    welcomeClone.style.display = 'block';
                    if (messagesContainer) {
                        messagesContainer.appendChild(welcomeClone);
                    }
                }
                
                // Add to conversations
                const conversation = {
                    id: currentChatId,
                    title: 'New Chat',
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString(),
                    messages: []
                };
                
                conversations.unshift(conversation);
                updateConversationList();
                
                if (isSidebarOpen) toggleSidebar();
                
                showToast('New chat started', 'success');
            } catch (error) {
                console.error('Error creating new chat:', error);
                showToast('Error creating new chat', 'error');
            }
        }

        function loadConversations() {
            try {
                if (!currentUser) return;
                
                const savedConversations = localStorage.getItem(`cyanix_conversations_${currentUser.id}`);
                if (savedConversations) {
                    conversations = JSON.parse(savedConversations);
                    updateConversationList();
                } else {
                    // Create demo conversations for new users
                    conversations = [
                        {
                            id: 'chat_1',
                            title: 'Python Programming Help',
                            createdAt: new Date(Date.now() - 3600000).toISOString(),
                            updatedAt: new Date(Date.now() - 3600000).toISOString(),
                            messages: []
                        },
                        {
                            id: 'chat_2',
                            title: 'Business Idea Brainstorming',
                            createdAt: new Date(Date.now() - 86400000).toISOString(),
                            updatedAt: new Date(Date.now() - 86400000).toISOString(),
                            messages: []
                        },
                        {
                            id: 'chat_3',
                            title: 'Learning Quantum Computing',
                            createdAt: new Date(Date.now() - 172800000).toISOString(),
                            updatedAt: new Date(Date.now() - 172800000).toISOString(),
                            messages: []
                        }
                    ];
                    updateConversationList();
                }
            } catch (error) {
                console.error('Error loading conversations:', error);
                conversations = [];
            }
        }

        function updateConversationList() {
            try {
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                const yesterday = new Date(today);
                yesterday.setDate(yesterday.getDate() - 1);
                
                const weekAgo = new Date(today);
                weekAgo.setDate(weekAgo.getDate() - 7);
                
                const todayConvos = conversations.filter(c => new Date(c.updatedAt) >= today);
                const yesterdayConvos = conversations.filter(c => 
                    new Date(c.updatedAt) >= yesterday && new Date(c.updatedAt) < today
                );
                const weekConvos = conversations.filter(c => 
                    new Date(c.updatedAt) >= weekAgo && new Date(c.updatedAt) < yesterday
                );
                
                updateConversationSection('todayConversations', todayConvos);
                updateConversationSection('yesterdayConversations', yesterdayConvos);
                updateConversationSection('weekConversations', weekConvos);
            } catch (error) {
                console.error('Error updating conversation list:', error);
            }
        }

        function updateConversationSection(sectionId, convos) {
            const section = document.getElementById(sectionId);
            if (!section) return;
            
            section.innerHTML = '';
            
            convos.forEach(convo => {
                const li = document.createElement('li');
                li.className = 'conversation-item';
                if (convo.id === currentChatId) li.classList.add('active');
                
                li.innerHTML = `
                    <i class="fas fa-comment conversation-icon"></i>
                    <span class="conversation-text">${convo.title}</span>
                `;
                
                li.onclick = () => loadChat(convo.id);
                section.appendChild(li);
            });
        }

        function loadChat(chatId) {
            try {
                currentChatId = chatId;
                const conversation = conversations.find(c => c.id === chatId);
                
                if (conversation) {
                    const chatTitle = document.getElementById('chatTitle');
                    const messagesContainer = document.getElementById('messagesContainer');
                    
                    if (chatTitle) chatTitle.textContent = conversation.title;
                    if (messagesContainer) messagesContainer.innerHTML = '';
                    
                    // Load messages
                    conversation.messages.forEach(msg => {
                        addMessageToUI(msg.content, msg.sender, msg.timestamp);
                    });
                    
                    updateConversationList();
                    if (isSidebarOpen) toggleSidebar();
                }
            } catch (error) {
                console.error('Error loading chat:', error);
                showToast('Error loading chat', 'error');
            }
        }

        // ==================== MESSAGING ====================
        async function sendMessage() {
            if (isProcessingMessage) {
                showToast('Please wait for the current response', 'warning');
                return;
            }
            
            const input = document.getElementById('chatInput');
            const sendButton = document.getElementById('sendButton');
            const message = input?.value?.trim() || '';
            
            if (!message) {
                showToast('Please enter a message', 'warning');
                return;
            }
            
            // Check if offline and OpenAI is enabled
            if (!navigator.onLine && useOpenAI) {
                showToast('You are offline. Please check your connection.', 'error');
                return;
            }
            
            isProcessingMessage = true;
            retryCount = 0;
            
            // Disable send button
            if (sendButton) {
                sendButton.disabled = true;
                sendButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
            }
            
            // Hide welcome screen
            const welcomeScreen = document.getElementById('welcomeScreen');
            if (welcomeScreen) {
                welcomeScreen.remove();
            }
            
            // Add user message
            addMessageToUI(message, 'user');
            
            // Clear input
            if (input) {
                input.value = '';
                autoResizeInput(input);
            }
            
            // Show typing indicator
            showTypingIndicator();
            
            // Save to conversation
            let conversation = conversations.find(c => c.id === currentChatId);
            if (!conversation) {
                // Create new conversation if none exists
                currentChatId = 'chat_' + Date.now();
                conversation = {
                    id: currentChatId,
                    title: message.substring(0, 30) + (message.length > 30 ? '...' : ''),
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString(),
                    messages: []
                };
                conversations.unshift(conversation);
                updateConversationList();
            }
            
            conversation.messages.push({
                id: 'msg_' + Date.now(),
                content: message,
                sender: 'user',
                timestamp: new Date().toISOString()
            });
            
            // Update conversation title if first message
            if (conversation.messages.length === 1) {
                conversation.title = message.substring(0, 30) + (message.length > 30 ? '...' : '');
                const chatTitle = document.getElementById('chatTitle');
                if (chatTitle) chatTitle.textContent = conversation.title;
            }
            
            conversation.updatedAt = new Date().toISOString();
            saveConversations();
            
            try {
                // Generate AI response
                let aiResponse;
                if (useOpenAI && openaiApiKey) {
                    aiResponse = await generateAIResponseWithRetry(message, conversation.messages);
                } else {
                    // Use mock response with delay
                    await new Promise(resolve => setTimeout(resolve, 1000 + Math.random() * 1000));
                    aiResponse = generateMockAIResponse(message);
                }
                
                hideTypingIndicator();
                addMessageToUI(aiResponse, 'assistant');
                
                // Save AI response
                conversation.messages.push({
                    id: 'msg_' + Date.now(),
                    content: aiResponse,
                    sender: 'assistant',
                    timestamp: new Date().toISOString()
                });
                conversation.updatedAt = new Date().toISOString();
                saveConversations();
                
                showToast('Response received', 'success');
                
            } catch (error) {
                hideTypingIndicator();
                console.error('Error generating response:', error);
                
                // Add error message
                const errorMessage = `I apologize, but I encountered an error: ${error.message}. Please check your AI settings or try again.`;
                addMessageToUI(errorMessage, 'assistant');
                
                // Save error response
                if (conversation) {
                    conversation.messages.push({
                        id: 'msg_' + Date.now(),
                        content: errorMessage,
                        sender: 'assistant',
                        timestamp: new Date().toISOString()
                    });
                    saveConversations();
                }
                
                showToast(`Error: ${error.message}`, 'error');
            } finally {
                // Re-enable send button
                if (sendButton) {
                    sendButton.disabled = false;
                    sendButton.innerHTML = '<i class="fas fa-paper-plane"></i>';
                }
                isProcessingMessage = false;
            }
        }

        async function generateAIResponseWithRetry(userMessage, conversationHistory) {
            while (retryCount < MAX_RETRIES) {
                try {
                    return await generateAIResponseWithOpenAI(userMessage, conversationHistory);
                } catch (error) {
                    retryCount++;
                    
                    if (retryCount === MAX_RETRIES) {
                        throw error;
                    }
                    
                    // Wait before retrying (exponential backoff)
                    const delay = Math.pow(2, retryCount) * 1000;
                    await new Promise(resolve => setTimeout(resolve, delay));
                    
                    showToast(`Retrying... (${retryCount}/${MAX_RETRIES})`, 'info');
                }
            }
            throw new Error('Max retries exceeded');
        }

        function addMessageToUI(content, sender, timestamp = null) {
            const container = document.getElementById('messagesContainer');
            if (!container) return;
            
            const messageDiv = document.createElement('div');
            
            messageDiv.className = `message ${sender}`;
            messageDiv.innerHTML = `
                <div class="message-header">
                    <div class="message-avatar ${sender}">
                        ${sender === 'user' ? (currentUser?.avatar || 'U') : 'AI'}
                    </div>
                    <div class="message-sender">
                        ${sender === 'user' ? (currentUser?.name || 'You') : 'Cyanix AI'}
                    </div>
                    <div class="message-time">
                        ${timestamp ? formatTime(timestamp) : formatTime(new Date().toISOString())}
                    </div>
                </div>
                <div class="message-content">${formatMessage(content)}</div>
                <div class="message-actions">
                    <button class="message-action" onclick="copyMessage(this)">
                        <i class="fas fa-copy"></i>
                    </button>
                    <button class="message-action" onclick="regenerateMessage(this)">
                        <i class="fas fa-redo"></i>
                    </button>
                    <button class="message-action" onclick="likeMessage(this)">
                        <i class="far fa-thumbs-up"></i>
                    </button>
                </div>
            `;
            
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        function showTypingIndicator() {
            const container = document.getElementById('messagesContainer');
            if (!container) return;
            
            const typingDiv = document.createElement('div');
            
            typingDiv.className = 'typing-indicator';
            typingDiv.id = 'typingIndicator';
            typingDiv.innerHTML = `
                <div class="typing-avatar">AI</div>
                <div class="typing-dots">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            `;
            
            container.appendChild(typingDiv);
            container.scrollTop = container.scrollHeight;
        }

        function hideTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            if (indicator) indicator.remove();
        }

        function useExample(type) {
            const examples = {
                brainstorm: "Help me brainstorm creative project ideas for a tech startup that combines AI with environmental sustainability.",
                explain: "Explain quantum computing in simple terms. How does it differ from classical computing, and what are its potential applications?",
                code: "Write a Python function to sort a list using quicksort algorithm. Include comments explaining each step and provide example usage.",
                analyze: "Analyze the pros and cons of renewable energy sources (solar, wind, hydro) compared to fossil fuels. Consider factors like cost, efficiency, environmental impact, and scalability."
            };

            const chatInput = document.getElementById('chatInput');
            if (chatInput && examples[type]) {
                chatInput.value = examples[type];
                autoResizeInput(chatInput);
                chatInput.focus();
            }
        }

        // ==================== UI UTILITIES ====================
        function autoResizeInput(textarea) {
            if (!textarea) return;
            
            textarea.style.height = 'auto';
            const newHeight = Math.min(textarea.scrollHeight, 200);
            textarea.style.height = newHeight + 'px';
        }

        function handleKeyDown(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        function formatMessage(text) {
            if (!text) return '';
            
            // Escape HTML to prevent XSS
            let escapedText = text
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#039;');
            
            // Process code blocks first
            escapedText = escapedText.replace(/```(\w+)?\n([\s\S]*?)\n```/g, (match, lang, code) => {
                const language = lang ? ` class="language-${lang}"` : '';
                return `<pre><code${language}>${code.trim()}</code></pre>`;
            });
            
            // Process inline code
            escapedText = escapedText.replace(/`([^`]+)`/g, '<code>$1</code>');
            
            // Process headers
            escapedText = escapedText.replace(/^### (.*$)/gm, '<h3>$1</h3>');
            escapedText = escapedText.replace(/^## (.*$)/gm, '<h2>$1</h2>');
            escapedText = escapedText.replace(/^# (.*$)/gm, '<h1>$1</h1>');
            
            // Process bold and italic
            escapedText = escapedText.replace(/\*\*\*(.*?)\*\*\*/g, '<strong><em>$1</em></strong>');
            escapedText = escapedText.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            escapedText = escapedText.replace(/\*(.*?)\*/g, '<em>$1</em>');
            
            // Process lists
            escapedText = escapedText.replace(/^\s*[-*]\s+(.*$)/gm, '<li>$1</li>');
            escapedText = escapedText.replace(/^\s*\d+\.\s+(.*$)/gm, '<li>$1</li>');
            
            // Process blockquotes
            escapedText = escapedText.replace(/^>\s+(.*$)/gm, '<blockquote>$1</blockquote>');
            
            // Process links
            escapedText = escapedText.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank" rel="noopener noreferrer">$1</a>');
            
            // Process line breaks
            escapedText = escapedText.replace(/\n\n/g, '</p><p>');
            escapedText = escapedText.replace(/\n/g, '<br>');
            
            // Wrap in paragraph if not already wrapped
            if (!escapedText.startsWith('<')) {
                escapedText = '<p>' + escapedText + '</p>';
            }
            
            return escapedText;
        }

        function formatTime(timestamp) {
            try {
                const date = new Date(timestamp);
                return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            } catch (error) {
                return 'Now';
            }
        }

        function showToast(message, type = 'info') {
            // Remove existing toasts
            const existingToasts = document.querySelectorAll('.toast');
            existingToasts.forEach(toast => toast.remove());
            
            // Create toast element
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            // Remove toast after timeout
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => {
                        if (toast.parentNode) {
                            toast.remove();
                        }
                    }, 300);
                }
            }, 3000);
        }

        // ==================== MESSAGE ACTIONS ====================
        function copyMessage(button) {
            try {
                const messageContent = button.closest('.message')?.querySelector('.message-content')?.textContent;
                if (!messageContent) {
                    showToast('Nothing to copy', 'warning');
                    return;
                }
                
                navigator.clipboard.writeText(messageContent)
                    .then(() => showToast('Copied to clipboard', 'success'))
                    .catch(() => showToast('Failed to copy', 'error'));
            } catch (error) {
                console.error('Error copying message:', error);
                showToast('Error copying message', 'error');
            }
        }

        function regenerateMessage(button) {
            const messageDiv = button.closest('.message');
            if (!messageDiv) return;
            
            const messageContent = messageDiv.querySelector('.message-content')?.textContent;
            if (!messageContent) return;
            
            // Show typing indicator
            showTypingIndicator();
            
            setTimeout(() => {
                hideTypingIndicator();
                const newResponse = generateMockAIResponse("Regenerate: " + messageContent);
                const contentElement = messageDiv.querySelector('.message-content');
                if (contentElement) {
                    contentElement.innerHTML = formatMessage(newResponse);
                }
                showToast('Message regenerated', 'success');
            }, 1000);
        }

        function likeMessage(button) {
            const icon = button.querySelector('i');
            if (!icon) return;
            
            if (icon.classList.contains('far')) {
                icon.classList.remove('far');
                icon.classList.add('fas');
                button.style.color = '#2ed573';
                showToast('Liked', 'success');
            } else {
                icon.classList.remove('fas');
                icon.classList.add('far');
                button.style.color = '';
                showToast('Unliked', 'info');
            }
        }

        // ==================== USER ACTIONS ====================
        function showProfile() {
            showToast('Profile page coming soon!', 'info');
            toggleUserMenu();
        }

        function showSettings() {
            showToast('Settings page coming soon!', 'info');
            toggleUserMenu();
        }

        function showUpgrade() {
            showToast('Upgrade to Pro for advanced features!', 'info');
            toggleUserMenu();
        }

        function exportData() {
            try {
                if (!currentUser) {
                    showToast('Please login first', 'error');
                    return;
                }
                
                const data = {
                    user: currentUser,
                    conversations: conversations,
                    exportDate: new Date().toISOString(),
                    version: '1.0'
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `cyanix-export-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showToast('Data exported successfully', 'success');
                toggleUserMenu();
            } catch (error) {
                console.error('Error exporting data:', error);
                showToast('Error exporting data', 'error');
            }
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                currentUser = null;
                currentChatId = null;
                conversations = [];
                
                localStorage.removeItem('cyanix_user');
                sessionStorage.removeItem('cyanix_user');
                
                const chatContainer = document.getElementById('chatContainer');
                const authContainer = document.getElementById('authContainer');
                
                if (chatContainer) chatContainer.classList.remove('active');
                if (authContainer) authContainer.style.display = 'flex';
                
                // Reset forms
                const signinEmail = document.getElementById('signinEmail');
                const signinPassword = document.getElementById('signinPassword');
                const signupName = document.getElementById('signupName');
                const signupEmail = document.getElementById('signupEmail');
                const signupPassword = document.getElementById('signupPassword');
                const signupConfirmPassword = document.getElementById('signupConfirmPassword');
                
                if (signinEmail) signinEmail.value = '';
                if (signinPassword) signinPassword.value = '';
                if (signupName) signupName.value = '';
                if (signupEmail) signupEmail.value = '';
                if (signupPassword) signupPassword.value = '';
                if (signupConfirmPassword) signupConfirmPassword.value = '';
                
                switchAuthTab('signin');
                showToast('Logged out successfully', 'success');
                toggleUserMenu();
            }
        }

        function clearChat() {
            if (confirm('Clear this chat? This cannot be undone.')) {
                try {
                    const conversation = conversations.find(c => c.id === currentChatId);
                    if (conversation) {
                        conversation.messages = [];
                        saveConversations();
                    }
                    
                    const messagesContainer = document.getElementById('messagesContainer');
                    if (messagesContainer) {
                        messagesContainer.innerHTML = '';
                        const welcomeScreen = document.getElementById('welcomeScreen');
                        if (welcomeScreen) {
                            const welcomeClone = welcomeScreen.cloneNode(true);
                            welcomeClone.style.display = 'block';
                            messagesContainer.appendChild(welcomeClone);
                        }
                    }
                    
                    showToast('Chat cleared', 'success');
                } catch (error) {
                    console.error('Error clearing chat:', error);
                    showToast('Error clearing chat', 'error');
                }
            }
        }

        function shareChat() {
            showToast('Share feature coming soon!', 'info');
        }

        function toggleDarkMode() {
            try {
                isDarkMode = !isDarkMode;
                const icon = document.querySelector('.header-btn:nth-child(3) i');
                
                if (isDarkMode) {
                    document.body.style.backgroundColor = 'var(--purple-dark)';
                    if (icon) {
                        icon.classList.remove('fa-sun');
                