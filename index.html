<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cyanix AI - Official</title>
    
    <!-- PWA Configuration -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#0ea5e9">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="/icons/icon-192x192.png">
    
    <!-- Fonts & Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* Primary Colors */
            --cyan-primary: #0ea5e9;
            --cyan-light: #7dd3fc;
            --cyan-dark: #0369a1;
            --cyan-gradient: linear-gradient(135deg, #0ea5e9, #3b82f6);
            
            /* Background Colors */
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --bg-card: rgba(30, 41, 59, 0.7);
            
            /* Text Colors */
            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
            --text-muted: #94a3b8;
            
            /* UI Colors */
            --border-color: #334155;
            --hover-color: rgba(148, 163, 184, 0.1);
            --active-color: rgba(14, 165, 233, 0.2);
            
            /* Status Colors */
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --info: #0ea5e9;
            
            /* Shadows */
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.4);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.4);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.5);
            
            /* Transitions */
            --transition-fast: 150ms ease;
            --transition-normal: 250ms ease;
            --transition-slow: 350ms ease;
            
            /* Border Radius */
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
            --radius-full: 9999px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
            position: fixed;
            width: 100%;
        }

        /* Layout */
        .app-container {
            display: flex;
            height: 100vh;
            height: 100dvh;
            width: 100%;
            position: relative;
        }

        /* Sidebar */
        .sidebar {
            width: 260px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            transition: transform var(--transition-normal);
            z-index: 100;
            position: relative;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo {
            width: 40px;
            height: 40px;
            background: var(--cyan-gradient);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 20px;
            color: white;
        }

        .app-name {
            font-size: 18px;
            font-weight: 700;
            background: linear-gradient(135deg, #0ea5e9, #3b82f6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .new-chat-btn {
            margin: 16px;
            padding: 12px 16px;
            background: var(--cyan-primary);
            color: white;
            border: none;
            border-radius: var(--radius-md);
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all var(--transition-fast);
        }

        .new-chat-btn:hover {
            background: var(--cyan-dark);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .conversations-list {
            flex: 1;
            overflow-y: auto;
            padding: 8px;
        }

        .conversation-item {
            padding: 12px;
            border-radius: var(--radius-md);
            cursor: pointer;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all var(--transition-fast);
        }

        .conversation-item:hover {
            background: var(--hover-color);
        }

        .conversation-item.active {
            background: var(--active-color);
            border-left: 3px solid var(--cyan-primary);
        }

        .conversation-icon {
            color: var(--text-muted);
            font-size: 14px;
        }

        .conversation-title {
            flex: 1;
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: var(--text-secondary);
        }

        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid var(--border-color);
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .user-profile:hover {
            background: var(--hover-color);
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: var(--radius-full);
            background: var(--cyan-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 14px;
        }

        .user-info {
            flex: 1;
        }

        .user-name {
            font-size: 14px;
            font-weight: 600;
        }

        .user-plan {
            font-size: 12px;
            color: var(--text-muted);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--bg-primary);
            position: relative;
        }

        .top-nav {
            padding: 16px 24px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: var(--bg-secondary);
        }

        .nav-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .menu-toggle {
            display: none;
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 20px;
            cursor: pointer;
            padding: 8px;
            border-radius: var(--radius-md);
            transition: all var(--transition-fast);
        }

        .menu-toggle:hover {
            background: var(--hover-color);
        }

        .current-model {
            padding: 6px 12px;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-full);
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .model-badge {
            padding: 2px 8px;
            background: var(--cyan-primary);
            color: white;
            border-radius: var(--radius-full);
            font-size: 12px;
            font-weight: 600;
        }

        .nav-actions {
            display: flex;
            gap: 8px;
        }

        .nav-btn {
            width: 36px;
            height: 36px;
            border-radius: var(--radius-md);
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-fast);
        }

        .nav-btn:hover {
            background: var(--hover-color);
            border-color: var(--cyan-primary);
        }

        /* Chat Area */
        .chat-area {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
            display: flex;
            flex-direction: column;
            gap: 24px;
            position: relative;
        }

        .welcome-section {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
            padding: 40px 0;
            animation: fadeIn 0.5s ease;
        }

        .welcome-title {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 16px;
            background: linear-gradient(135deg, #0ea5e9, #3b82f6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .welcome-subtitle {
            font-size: 16px;
            color: var(--text-secondary);
            margin-bottom: 32px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .capabilities-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 16px;
            margin-top: 32px;
        }

        .capability-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 20px;
            text-align: left;
            transition: all var(--transition-fast);
            cursor: pointer;
        }

        .capability-card:hover {
            transform: translateY(-4px);
            border-color: var(--cyan-primary);
            box-shadow: var(--shadow-lg);
        }

        .capability-icon {
            width: 48px;
            height: 48px;
            border-radius: var(--radius-md);
            background: rgba(14, 165, 233, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 16px;
            color: var(--cyan-primary);
            font-size: 20px;
        }

        .capability-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .capability-desc {
            font-size: 14px;
            color: var(--text-muted);
            line-height: 1.5;
        }

        /* Messages */
        .message {
            max-width: 800px;
            margin: 0 auto;
            display: flex;
            gap: 16px;
            animation: slideIn 0.3s ease;
            width: 100%;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: var(--radius-full);
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
        }

        .message-avatar.user {
            background: linear-gradient(135deg, #3b82f6, #6366f1);
            color: white;
        }

        .message-avatar.assistant {
            background: var(--cyan-gradient);
            color: white;
        }

        .message-content {
            flex: 1;
            padding-top: 4px;
        }

        .message-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 4px;
        }

        .message-sender {
            font-weight: 600;
            font-size: 14px;
        }

        .message-time {
            font-size: 12px;
            color: var(--text-muted);
        }

        .message-text {
            line-height: 1.6;
            font-size: 15px;
            color: var(--text-primary);
        }

        .message-text p {
            margin-bottom: 12px;
        }

        .message-text p:last-child {
            margin-bottom: 0;
        }

        .message-text pre {
            background: var(--bg-secondary);
            border-radius: var(--radius-md);
            padding: 16px;
            overflow-x: auto;
            margin: 16px 0;
            border: 1px solid var(--border-color);
        }

        .message-text code {
            background: var(--bg-secondary);
            padding: 2px 6px;
            border-radius: var(--radius-sm);
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }

        .message-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
            opacity: 0;
            transition: opacity var(--transition-fast);
        }

        .message:hover .message-actions {
            opacity: 1;
        }

        .message-action-btn {
            width: 28px;
            height: 28px;
            border-radius: var(--radius-md);
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            transition: all var(--transition-fast);
        }

        .message-action-btn:hover {
            background: var(--hover-color);
            color: var(--cyan-primary);
        }

        /* Input Area - Clean Design */
        .input-container {
            max-width: 800px;
            margin: 0 auto 24px;
            width: 100%;
            padding: 0 24px;
            position: relative;
        }

        .input-wrapper {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-xl);
            padding: 16px;
            position: relative;
            transition: all var(--transition-fast);
            display: flex;
            align-items: flex-end;
            gap: 12px;
        }

        .input-wrapper:focus-within {
            border-color: var(--cyan-primary);
            box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.1);
        }

        .message-input {
            flex: 1;
            background: none;
            border: none;
            color: var(--text-primary);
            font-family: inherit;
            font-size: 15px;
            line-height: 1.5;
            resize: none;
            max-height: 200px;
            min-height: 24px;
            outline: none;
        }

        .message-input::placeholder {
            color: var(--text-muted);
        }

        .send-btn {
            width: 40px;
            height: 40px;
            min-width: 40px;
            border-radius: var(--radius-md);
            background: var(--cyan-gradient);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-fast);
            flex-shrink: 0;
        }

        .send-btn:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: var(--shadow-md);
        }

        .send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .input-attach-btn {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-md);
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-fast);
            flex-shrink: 0;
        }

        .input-attach-btn:hover {
            background: var(--hover-color);
            color: var(--cyan-primary);
        }

        /* Typing Indicator */
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 12px 16px;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            width: fit-content;
            margin: 0 auto;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: var(--radius-full);
            background: var(--cyan-primary);
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 0.6;
            }
            30% {
                transform: translateY(-8px);
                opacity: 1;
            }
        }

        /* Modal Overlay */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        .modal-overlay.active {
            display: flex;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Auth Modal */
        .auth-modal {
            background: var(--bg-secondary);
            border-radius: var(--radius-xl);
            width: 90%;
            max-width: 440px;
            overflow: hidden;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(40px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .auth-header {
            padding: 32px 32px 20px;
            text-align: center;
            border-bottom: 1px solid var(--border-color);
        }

        .auth-logo {
            width: 64px;
            height: 64px;
            background: var(--cyan-gradient);
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            font-weight: 800;
            color: white;
            margin: 0 auto 20px;
        }

        .auth-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .auth-subtitle {
            color: var(--text-muted);
            font-size: 14px;
        }

        .auth-body {
            padding: 32px;
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 24px;
            border-bottom: 1px solid var(--border-color);
        }

        .auth-tab {
            flex: 1;
            padding: 12px;
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            position: relative;
        }

        .auth-tab.active {
            color: var(--cyan-primary);
        }

        .auth-tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--cyan-primary);
        }

        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .form-label {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .form-input {
            padding: 12px 16px;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            font-size: 15px;
            transition: all var(--transition-fast);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--cyan-primary);
            box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.1);
        }

        .form-error {
            color: var(--error);
            font-size: 13px;
            margin-top: 4px;
            display: none;
        }

        .form-error.show {
            display: block;
        }

        .auth-btn {
            padding: 14px;
            background: var(--cyan-gradient);
            color: white;
            border: none;
            border-radius: var(--radius-md);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
            margin-top: 8px;
        }

        .auth-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .auth-footer {
            padding: 20px 32px;
            border-top: 1px solid var(--border-color);
            text-align: center;
            font-size: 14px;
            color: var(--text-muted);
        }

        .auth-link {
            color: var(--cyan-primary);
            text-decoration: none;
            font-weight: 600;
        }

        .auth-link:hover {
            text-decoration: underline;
        }

        /* Settings Modal */
        .settings-modal {
            background: var(--bg-secondary);
            border-radius: var(--radius-xl);
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .settings-header {
            padding: 24px 32px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .settings-title {
            font-size: 20px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .settings-close {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-md);
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-fast);
        }

        .settings-close:hover {
            background: var(--hover-color);
        }

        .settings-body {
            flex: 1;
            overflow-y: auto;
            padding: 32px;
            display: flex;
            flex-direction: column;
            gap: 32px;
        }

        .settings-section {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .section-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 16px;
        }

        .setting-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            transition: all var(--transition-fast);
        }

        .setting-card:hover {
            border-color: var(--cyan-primary);
        }

        .setting-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .setting-title {
            font-weight: 600;
            font-size: 15px;
        }

        .setting-desc {
            color: var(--text-muted);
            font-size: 14px;
            line-height: 1.5;
        }

        .toggle-switch {
            position: relative;
            width: 52px;
            height: 28px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg-tertiary);
            transition: var(--transition-fast);
            border-radius: var(--radius-full);
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 4px;
            background: white;
            transition: var(--transition-fast);
            border-radius: var(--radius-full);
        }

        input:checked + .toggle-slider {
            background: var(--cyan-primary);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }

        .select-wrapper {
            position: relative;
        }

        .select-wrapper select {
            width: 100%;
            padding: 12px 16px;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            font-size: 14px;
            appearance: none;
            cursor: pointer;
        }

        .select-wrapper::after {
            content: "⌄";
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            pointer-events: none;
        }

        .plan-card {
            background: var(--bg-card);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 24px;
            display: flex;
            flex-direction: column;
            gap: 16px;
            transition: all var(--transition-fast);
            cursor: pointer;
        }

        .plan-card:hover {
            border-color: var(--cyan-primary);
            transform: translateY(-4px);
        }

        .plan-card.recommended {
            border-color: var(--cyan-primary);
            position: relative;
            overflow: hidden;
        }

        .plan-badge {
            position: absolute;
            top: 16px;
            right: -28px;
            background: var(--cyan-primary);
            color: white;
            padding: 4px 32px;
            font-size: 12px;
            font-weight: 600;
            transform: rotate(45deg);
        }

        .plan-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .plan-name {
            font-size: 18px;
            font-weight: 700;
        }

        .plan-price {
            font-size: 24px;
            font-weight: 700;
            color: var(--cyan-primary);
        }

        .plan-price span {
            font-size: 14px;
            color: var(--text-muted);
            font-weight: 400;
        }

        .plan-features {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .plan-features li {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .plan-features li i {
            color: var(--success);
        }

        .plan-btn {
            padding: 12px;
            background: var(--cyan-gradient);
            color: white;
            border: none;
            border-radius: var(--radius-md);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
            margin-top: 8px;
        }

        .plan-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            bottom: 24px;
            right: 24px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 1001;
            max-width: 400px;
        }

        .toast {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideInRight 0.3s ease;
            box-shadow: var(--shadow-lg);
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .toast-icon {
            width: 24px;
            height: 24px;
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            flex-shrink: 0;
        }

        .toast-icon.success {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }

        .toast-icon.error {
            background: rgba(239, 68, 68, 0.1);
            color: var(--error);
        }

        .toast-icon.info {
            background: rgba(14, 165, 233, 0.1);
            color: var(--info);
        }

        .toast-content {
            flex: 1;
        }

        .toast-title {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 2px;
        }

        .toast-message {
            font-size: 13px;
            color: var(--text-muted);
        }

        .toast-close {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 18px;
            padding: 4px;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .sidebar {
                position: fixed;
                left: 0;
                top: 0;
                bottom: 0;
                transform: translateX(-100%);
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .menu-toggle {
                display: block;
            }
        }

        @media (max-width: 768px) {
            .capabilities-grid {
                grid-template-columns: 1fr;
            }

            .settings-grid {
                grid-template-columns: 1fr;
            }

            .message {
                gap: 12px;
            }

            .chat-area {
                padding: 16px;
            }

            .input-container {
                padding: 0 16px 24px;
            }

            .auth-modal {
                width: 95%;
            }

            .input-wrapper {
                padding: 12px;
            }

            .message-input {
                font-size: 14px;
            }

            .send-btn, .input-attach-btn {
                width: 36px;
                height: 36px;
            }
        }

        @media (max-width: 480px) {
            .input-wrapper {
                padding: 10px;
            }

            .message-input {
                font-size: 14px;
            }

            .send-btn, .input-attach-btn {
                width: 32px;
                height: 32px;
                min-width: 32px;
            }

            .input-attach-btn {
                display: none; /* Hide on very small screens */
            }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
            border-radius: var(--radius-full);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--bg-tertiary);
            border-radius: var(--radius-full);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--cyan-primary);
        }

        /* Hidden class */
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">C</div>
                <div class="app-name">Cyanix AI</div>
            </div>

            <button class="new-chat-btn" id="newChatBtn">
                <i class="fas fa-plus"></i>
                New Chat
            </button>

            <div class="conversations-list" id="conversationsList">
                <!-- Conversations will be loaded here -->
            </div>

            <div class="sidebar-footer">
                <div class="user-profile" id="userProfile">
                    <div class="user-avatar" id="userAvatar">U</div>
                    <div class="user-info">
                        <div class="user-name" id="userName">Guest User</div>
                        <div class="user-plan" id="userPlan">Free Plan</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Top Navigation -->
            <div class="top-nav">
                <div class="nav-left">
                    <button class="menu-toggle" id="menuToggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="current-model">
                        <i class="fas fa-brain"></i>
                        <span id="currentModelName">Cyanix Pro</span>
                        <span class="model-badge" id="modelBadge">Pro</span>
                    </div>
                </div>

                <div class="nav-right">
                    <div class="nav-actions">
                        <button class="nav-btn" id="historyBtn" title="History">
                            <i class="fas fa-history"></i>
                        </button>
                        <button class="nav-btn" id="settingsBtn" title="Settings">
                            <i class="fas fa-cog"></i>
                        </button>
                        <button class="nav-btn" id="upgradeBtn" title="Upgrade">
                            <i class="fas fa-crown"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Chat Area -->
            <div class="chat-area" id="chatArea">
                <div class="welcome-section" id="welcomeSection">
                    <h1 class="welcome-title">Welcome to Cyanix AI</h1>
                    <p class="welcome-subtitle">
                        Your intelligent assistant for writing, coding, analysis, and creative tasks. 
                        How can I help you today?
                    </p>

                    <div class="capabilities-grid">
                        <div class="capability-card" onclick="sendQuickPrompt('Help me write a professional email')">
                            <div class="capability-icon">
                                <i class="fas fa-envelope"></i>
                            </div>
                            <div class="capability-title">Email Writing</div>
                            <div class="capability-desc">
                                Craft professional emails, responses, and communications
                            </div>
                        </div>

                        <div class="capability-card" onclick="sendQuickPrompt('Write Python code to sort a list')">
                            <div class="capability-icon">
                                <i class="fas fa-code"></i>
                            </div>
                            <div class="capability-title">Code Generation</div>
                            <div class="capability-desc">
                                Write, debug, and explain code in multiple programming languages
                            </div>
                        </div>

                        <div class="capability-card" onclick="sendQuickPrompt('Explain quantum computing in simple terms')">
                            <div class="capability-icon">
                                <i class="fas fa-lightbulb"></i>
                            </div>
                            <div class="capability-title">Learning & Explaining</div>
                            <div class="capability-desc">
                                Get clear explanations of complex topics at any level
                            </div>
                        </div>

                        <div class="capability-card" onclick="sendQuickPrompt('Create a business plan outline')">
                            <div class="capability-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div class="capability-title">Creative Writing</div>
                            <div class="capability-desc">
                                Generate ideas, outlines, stories, and creative content
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Messages will be loaded here -->
                <div id="messagesContainer"></div>

                <!-- Typing indicator -->
                <div class="typing-indicator hidden" id="typingIndicator">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            </div>

            <!-- Input Area - Clean Design -->
            <div class="input-container">
                <div class="input-wrapper">
                    <button class="input-attach-btn" id="attachBtn" title="Attach file">
                        <i class="fas fa-paperclip"></i>
                    </button>
                    
                    <textarea 
                        class="message-input" 
                        id="messageInput"
                        placeholder="Message Cyanix AI..."
                        rows="1"
                        oninput="autoResizeInput(this)"
                        onkeydown="handleKeyDown(event)"
                    ></textarea>
                    
                    <button class="send-btn" id="sendBtn" onclick="sendMessage()">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Auth Modal -->
    <div class="modal-overlay" id="authModal">
        <div class="auth-modal">
            <div class="auth-header">
                <div class="auth-logo">C</div>
                <h2 class="auth-title">Welcome to Cyanix AI</h2>
                <p class="auth-subtitle">Sign in to access your personalized AI assistant</p>
            </div>

            <div class="auth-tabs">
                <button class="auth-tab active" data-tab="login">Sign In</button>
                <button class="auth-tab" data-tab="signup">Create Account</button>
            </div>

            <div class="auth-body">
                <form class="auth-form" id="loginForm">
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-input" id="loginEmail" placeholder="you@example.com" required>
                        <div class="form-error" id="loginEmailError"></div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <input type="password" class="form-input" id="loginPassword" placeholder="••••••••" required>
                        <div class="form-error" id="loginPasswordError"></div>
                    </div>

                    <button type="submit" class="auth-btn">Sign In</button>
                </form>

                <form class="auth-form hidden" id="signupForm">
                    <div class="form-group">
                        <label class="form-label">Full Name</label>
                        <input type="text" class="form-input" id="signupName" placeholder="John Doe" required>
                        <div class="form-error" id="signupNameError"></div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-input" id="signupEmail" placeholder="you@example.com" required>
                        <div class="form-error" id="signupEmailError"></div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <input type="password" class="form-input" id="signupPassword" placeholder="••••••••" required>
                        <div class="form-error" id="signupPasswordError"></div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Confirm Password</label>
                        <input type="password" class="form-input" id="signupConfirmPassword" placeholder="••••••••" required>
                        <div class="form-error" id="signupConfirmPasswordError"></div>
                    </div>

                    <button type="submit" class="auth-btn">Create Account</button>
                </form>
            </div>

            <div class="auth-footer">
                By continuing, you agree to our <a href="#" class="auth-link">Terms</a> and <a href="#" class="auth-link">Privacy Policy</a>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal-overlay" id="settingsModal">
        <div class="settings-modal">
            <div class="settings-header">
                <h2 class="settings-title">
                    <i class="fas fa-cog"></i>
                    Settings
                </h2>
                <button class="settings-close" id="closeSettings">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="settings-body">
                <div class="settings-section">
                    <h3 class="section-title">
                        <i class="fas fa-user"></i>
                        Account
                    </h3>
                    <div class="settings-grid">
                        <div class="setting-card">
                            <div class="setting-header">
                                <div class="setting-title">Account Details</div>
                            </div>
                            <div class="setting-desc">
                                Manage your profile, email, and account settings
                            </div>
                            <button class="plan-btn" onclick="showAccountDetails()">Edit Profile</button>
                        </div>

                        <div class="setting-card">
                            <div class="setting-header">
                                <div class="setting-title">Subscription Plan</div>
                                <span class="model-badge" id="currentPlanBadge">Free</span>
                            </div>
                            <div class="setting-desc">
                                You're currently on the Free plan. Upgrade for more features.
                            </div>
                            <button class="plan-btn" onclick="showPlans()">Upgrade Plan</button>
                        </div>
                    </div>
                </div>

                <div class="settings-section">
                    <h3 class="section-title">
                        <i class="fas fa-brain"></i>
                        AI Settings
                    </h3>
                    <div class="settings-grid">
                        <div class="setting-card">
                            <div class="setting-header">
                                <div class="setting-title">AI Model</div>
                            </div>
                            <div class="setting-desc">
                                Choose which AI model to use for responses
                            </div>
                            <div class="select-wrapper">
                                <select id="aiModelSelect">
                                    <option value="cyanix-pro">Cyanix Pro (Recommended)</option>
                                    <option value="cyanix-fast">Cyanix Fast</option>
                                    <option value="cyanix-deep">Cyanix Deep</option>
                                </select>
                            </div>
                        </div>

                        <div class="setting-card">
                            <div class="setting-header">
                                <div class="setting-title">Response Style</div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="creativeMode">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="setting-desc">
                                Creative mode provides more imaginative and varied responses
                            </div>
                        </div>

                        <div class="setting-card">
                            <div class="setting-header">
                                <div class="setting-title">Voice Responses</div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="voiceResponses" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="setting-desc">
                                Read responses aloud using text-to-speech
                            </div>
                        </div>
                    </div>
                </div>

                <div class="settings-section">
                    <h3 class="section-title">
                        <i class="fas fa-key"></i>
                        API Configuration
                    </h3>
                    <div class="setting-card">
                        <div class="setting-header">
                            <div class="setting-title">API Keys</div>
                        </div>
                        <div class="setting-desc">
                            Configure your own API keys for unlimited usage
                        </div>
                        <button class="plan-btn" onclick="showApiConfig()">Configure API Keys</button>
                    </div>
                </div>

                <div class="settings-section">
                    <h3 class="section-title">
                        <i class="fas fa-mobile-alt"></i>
                        App Settings
                    </h3>
                    <div class="settings-grid">
                        <div class="setting-card">
                            <div class="setting-header">
                                <div class="setting-title">Dark Mode</div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="darkMode" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="setting-desc">
                                Toggle between light and dark theme
                            </div>
                        </div>

                        <div class="setting-card">
                            <div class="setting-header">
                                <div class="setting-title">Chat History</div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="saveHistory" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="setting-desc">
                                Save your conversation history locally
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Subscription Plans Modal -->
    <div class="modal-overlay" id="plansModal">
        <div class="settings-modal">
            <div class="settings-header">
                <h2 class="settings-title">
                    <i class="fas fa-crown"></i>
                    Upgrade Your Plan
                </h2>
                <button class="settings-close" onclick="closeModal('plansModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="settings-body">
                <div class="settings-grid">
                    <div class="plan-card">
                        <div class="plan-header">
                            <div class="plan-name">Free</div>
                            <div class="plan-price">$0<span>/month</span></div>
                        </div>
                        <ul class="plan-features">
                            <li><i class="fas fa-check"></i> Basic AI responses</li>
                            <li><i class="fas fa-check"></i> 50 messages/month</li>
                            <li><i class="fas fa-check"></i> Standard models</li>
                            <li><i class="fas fa-times"></i> No file uploads</li>
                            <li><i class="fas fa-times"></i> No API access</li>
                        </ul>
                        <button class="plan-btn" onclick="selectPlan('free')">Current Plan</button>
                    </div>

                    <div class="plan-card recommended">
                        <div class="plan-badge">POPULAR</div>
                        <div class="plan-header">
                            <div class="plan-name">Pro</div>
                            <div class="plan-price">$19<span>/month</span></div>
                        </div>
                        <ul class="plan-features">
                            <li><i class="fas fa-check"></i> Advanced AI responses</li>
                            <li><i class="fas fa-check"></i> Unlimited messages</li>
                            <li><i class="fas fa-check"></i> All AI models</li>
                            <li><i class="fas fa-check"></i> File uploads (images, PDFs)</li>
                            <li><i class="fas fa-check"></i> Priority support</li>
                        </ul>
                        <button class="plan-btn" onclick="selectPlan('pro')">Upgrade to Pro</button>
                    </div>

                    <div class="plan-card">
                        <div class="plan-header">
                            <div class="plan-name">Team</div>
                            <div class="plan-price">$49<span>/month</span></div>
                        </div>
                        <ul class="plan-features">
                            <li><i class="fas fa-check"></i> Everything in Pro</li>
                            <li><i class="fas fa-check"></i> Up to 5 users</li>
                            <li><i class="fas fa-check"></i> Team collaboration</li>
                            <li><i class="fas fa-check"></i> Custom models</li>
                            <li><i class="fas fa-check"></i> API access included</li>
                        </ul>
                        <button class="plan-btn" onclick="selectPlan('team')">Choose Team</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============ APPLICATION STATE ============
        const AppState = {
            currentUser: null,
            currentConversation: null,
            conversations: [],
            isAuthenticated: false,
            aiModel: 'cyanix-pro',
            isTyping: false,
            settings: {
                creativeMode: false,
                voiceResponses: true,
                darkMode: true,
                saveHistory: true
            },
            subscription: {
                plan: 'free',
                messagesUsed: 0,
                messagesLimit: 50,
                expiresAt: null
            }
        };

        // ============ DOM ELEMENTS ============
        const elements = {
            sidebar: document.getElementById('sidebar'),
            menuToggle: document.getElementById('menuToggle'),
            newChatBtn: document.getElementById('newChatBtn'),
            conversationsList: document.getElementById('conversationsList'),
            userProfile: document.getElementById('userProfile'),
            userAvatar: document.getElementById('userAvatar'),
            userName: document.getElementById('userName'),
            userPlan: document.getElementById('userPlan'),
            chatArea: document.getElementById('chatArea'),
            welcomeSection: document.getElementById('welcomeSection'),
            messagesContainer: document.getElementById('messagesContainer'),
            typingIndicator: document.getElementById('typingIndicator'),
            messageInput: document.getElementById('messageInput'),
            sendBtn: document.getElementById('sendBtn'),
            attachBtn: document.getElementById('attachBtn'),
            currentModelName: document.getElementById('currentModelName'),
            modelBadge: document.getElementById('modelBadge'),
            historyBtn: document.getElementById('historyBtn'),
            settingsBtn: document.getElementById('settingsBtn'),
            upgradeBtn: document.getElementById('upgradeBtn'),
            authModal: document.getElementById('authModal'),
            settingsModal: document.getElementById('settingsModal'),
            plansModal: document.getElementById('plansModal'),
            toastContainer: document.getElementById('toastContainer'),
            loginForm: document.getElementById('loginForm'),
            signupForm: document.getElementById('signupForm'),
            authTabs: document.querySelectorAll('.auth-tab'),
            closeSettings: document.getElementById('closeSettings'),
            aiModelSelect: document.getElementById('aiModelSelect'),
            creativeMode: document.getElementById('creativeMode'),
            voiceResponses: document.getElementById('voiceResponses'),
            darkMode: document.getElementById('darkMode'),
            saveHistory: document.getElementById('saveHistory'),
            currentPlanBadge: document.getElementById('currentPlanBadge')
        };

        // ============ TOAST SYSTEM ============
        function showToast(type, title, message) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            
            const icons = {
                success: 'fas fa-check-circle',
                error: 'fas fa-exclamation-circle',
                info: 'fas fa-info-circle'
            };
            
            toast.innerHTML = `
                <div class="toast-icon ${type}">
                    <i class="${icons[type]}"></i>
                </div>
                <div class="toast-content">
                    <div class="toast-title">${title}</div>
                    <div class="toast-message">${message}</div>
                </div>
                <button class="toast-close" onclick="this.parentElement.remove()">×</button>
            `;
            
            elements.toastContainer.appendChild(toast);
            
            setTimeout(() => {
                if (toast.parentElement) {
                    toast.remove();
                }
            }, 5000);
        }

        // ============ AUTHENTICATION SYSTEM ============
        function checkAuth() {
            const user = localStorage.getItem('cyanix_user');
            if (user) {
                AppState.currentUser = JSON.parse(user);
                AppState.isAuthenticated = true;
                updateUIForAuth();
                loadConversations();
                return true;
            } else {
                showAuthModal();
                return false;
            }
        }

        function showAuthModal() {
            elements.authModal.classList.add('active');
        }

        function hideAuthModal() {
            elements.authModal.classList.remove('active');
        }

        function updateUIForAuth() {
            if (AppState.currentUser) {
                const { name, email, plan } = AppState.currentUser;
                const initials = name.split(' ').map(n => n[0]).join('').toUpperCase();
                
                elements.userAvatar.textContent = initials;
                elements.userName.textContent = name;
                elements.userPlan.textContent = `${plan.charAt(0).toUpperCase() + plan.slice(1)} Plan`;
                elements.currentPlanBadge.textContent = plan.charAt(0).toUpperCase() + plan.slice(1);
                
                // Update subscription state
                AppState.subscription.plan = plan;
                
                // Show upgrade button if free plan
                if (plan === 'free') {
                    elements.upgradeBtn.style.display = 'flex';
                }
            }
        }

        // ============ CONVERSATION MANAGEMENT ============
        function createNewConversation() {
            const conversation = {
                id: Date.now().toString(),
                title: 'New Conversation',
                messages: [],
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            AppState.currentConversation = conversation;
            AppState.conversations.unshift(conversation);
            
            updateConversationsList();
            showConversation(conversation.id);
            
            showToast('info', 'New conversation', 'Started a new conversation');
        }

        function loadConversations() {
            const saved = localStorage.getItem('cyanix_conversations');
            if (saved) {
                AppState.conversations = JSON.parse(saved);
                updateConversationsList();
                
                if (AppState.conversations.length > 0) {
                    showConversation(AppState.conversations[0].id);
                }
            }
        }

        function saveConversations() {
            localStorage.setItem('cyanix_conversations', JSON.stringify(AppState.conversations));
        }

        function updateConversationsList() {
            elements.conversationsList.innerHTML = '';
            
            AppState.conversations.forEach(conv => {
                const item = document.createElement('div');
                item.className = `conversation-item ${AppState.currentConversation?.id === conv.id ? 'active' : ''}`;
                item.innerHTML = `
                    <div class="conversation-icon">
                        <i class="fas fa-message"></i>
                    </div>
                    <div class="conversation-title">${conv.title}</div>
                `;
                
                item.addEventListener('click', () => showConversation(conv.id));
                elements.conversationsList.appendChild(item);
            });
        }

        function showConversation(conversationId) {
            const conversation = AppState.conversations.find(c => c.id === conversationId);
            if (!conversation) return;
            
            AppState.currentConversation = conversation;
            updateConversationsList();
            
            // Hide welcome section
            elements.welcomeSection.classList.add('hidden');
            
            // Clear and show messages
            elements.messagesContainer.innerHTML = '';
            
            conversation.messages.forEach(message => {
                addMessageToUI(message.content, message.role === 'user', false);
            });
            
            // Scroll to bottom
            setTimeout(() => {
                elements.chatArea.scrollTop = elements.chatArea.scrollHeight;
            }, 100);
        }

        // ============ MESSAGE HANDLING ============
        function addMessageToUI(content, isUser = false, animate = true) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message';
            if (animate) {
                messageDiv.style.animation = 'slideIn 0.3s ease';
            }
            
            const sender = isUser ? 'You' : 'Cyanix AI';
            const avatarText = isUser ? 'U' : 'C';
            const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            messageDiv.innerHTML = `
                <div class="message-avatar ${isUser ? 'user' : 'assistant'}">${avatarText}</div>
                <div class="message-content">
                    <div class="message-header">
                        <div class="message-sender">${sender}</div>
                        <div class="message-time">${time}</div>
                    </div>
                    <div class="message-text">${formatMessage(content)}</div>
                    <div class="message-actions">
                        <button class="message-action-btn" title="Copy">
                            <i class="fas fa-copy"></i>
                        </button>
                        <button class="message-action-btn" title="Like">
                            <i class="fas fa-thumbs-up"></i>
                        </button>
                        <button class="message-action-btn" title="Dislike">
                            <i class="fas fa-thumbs-down"></i>
                        </button>
                    </div>
                </div>
            `;
            
            elements.messagesContainer.appendChild(messageDiv);
            
            // Add click handlers for action buttons
            const copyBtn = messageDiv.querySelector('.message-action-btn:nth-child(1)');
            const likeBtn = messageDiv.querySelector('.message-action-btn:nth-child(2)');
            const dislikeBtn = messageDiv.querySelector('.message-action-btn:nth-child(3)');
            
            copyBtn.addEventListener('click', () => {
                navigator.clipboard.writeText(content);
                showToast('success', 'Copied!', 'Message copied to clipboard');
            });
            
            likeBtn.addEventListener('click', () => {
                likeBtn.style.color = 'var(--success)';
                dislikeBtn.style.color = 'var(--text-secondary)';
            });
            
            dislikeBtn.addEventListener('click', () => {
                dislikeBtn.style.color = 'var(--error)';
                likeBtn.style.color = 'var(--text-secondary)';
            });
            
            // Scroll to bottom
            setTimeout(() => {
                elements.chatArea.scrollTop = elements.chatArea.scrollHeight;
            }, 100);
            
            return messageDiv;
        }

        function formatMessage(text) {
            // Simple markdown-like formatting
            return text
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/`([^`]+)`/g, '<code>$1</code>')
                .replace(/\n/g, '<br>');
        }

        async function sendMessage() {
            const message = elements.messageInput.value.trim();
            if (!message) return;
            
            if (!AppState.isAuthenticated) {
                showAuthModal();
                showToast('error', 'Authentication Required', 'Please sign in to use Cyanix AI');
                return;
            }
            
            // Check message limits for free users
            if (AppState.subscription.plan === 'free') {
                AppState.subscription.messagesUsed++;
                if (AppState.subscription.messagesUsed >= AppState.subscription.messagesLimit) {
                    showToast('error', 'Limit Reached', 'Upgrade to Pro for unlimited messages');
                    elements.upgradeBtn.click();
                    return;
                }
            }
            
            // Clear input
            elements.messageInput.value = '';
            autoResizeInput(elements.messageInput);
            
            // Add user message to UI
            addMessageToUI(message, true);
            
            // Hide welcome section
            elements.welcomeSection.classList.add('hidden');
            
            // Show typing indicator
            elements.typingIndicator.classList.remove('hidden');
            
            // Add to current conversation
            if (AppState.currentConversation) {
                AppState.currentConversation.messages.push({
                    content: message,
                    role: 'user',
                    timestamp: new Date().toISOString()
                });
                
                // Update conversation title if first message
                if (AppState.currentConversation.messages.length === 1) {
                    AppState.currentConversation.title = message.substring(0, 30) + (message.length > 30 ? '...' : '');
                }
                
                AppState.currentConversation.updatedAt = new Date().toISOString();
            }
            
            // Simulate AI response (in production, this would be API call)
            setTimeout(async () => {
                elements.typingIndicator.classList.add('hidden');
                
                const response = await generateAIResponse(message);
                
                // Add AI response to UI
                addMessageToUI(response, false);
                
                // Add to conversation
                if (AppState.currentConversation) {
                    AppState.currentConversation.messages.push({
                        content: response,
                        role: 'assistant',
                        timestamp: new Date().toISOString()
                    });
                    
                    saveConversations();
                    updateConversationsList();
                }
                
                // Speak response if enabled
                if (AppState.settings.voiceResponses && 'speechSynthesis' in window) {
                    speakResponse(response);
                }
            }, 1500);
        }

        async function generateAIResponse(prompt) {
            // In production, this would call your AI API
            // For demo, we'll generate simulated responses
            
            const responses = {
                'cyanix-pro': [
                    `I've analyzed your query about "${prompt.substring(0, 30)}..." and here's my comprehensive response. This topic involves several key considerations that are important to address systematically. First, let's break down the core concepts before diving into specific applications or implications.`,
                    
                    `Based on your question, I'd approach this by considering multiple perspectives. The main points to address are: 1) The fundamental principles, 2) Practical applications, 3) Common challenges, and 4) Best practices. Let me elaborate on each of these aspects to give you a thorough understanding.`,
                    
                    `That's an excellent question that touches on several important areas. Let me provide you with a detailed explanation that covers both theoretical foundations and practical implementations. This will help you understand not just what it is, but how to effectively apply this knowledge in real-world scenarios.`
                ],
                'cyanix-fast': [
                    `Here's a quick answer to your question about ${prompt.substring(0, 30)}... The key points are: First point, second point, and third point.`,
                    
                    `Short answer: The main idea is focused on efficiency and clarity. Let me know if you need more details!`,
                    
                    `Quick response: ${prompt.substring(0, 30)}... involves several factors that work together to create the outcome you're asking about.`
                ],
                'cyanix-deep': [
                    `Let me provide a deeply analytical response to your query. This involves examining the historical context, theoretical foundations, current applications, and future implications. Each layer reveals important insights that contribute to a comprehensive understanding of "${prompt.substring(0, 30)}..."`,
                    
                    `This is a complex topic that deserves thorough exploration. I'll analyze it from multiple dimensions including philosophical underpinnings, technical implementations, sociocultural impacts, and potential evolutionary trajectories. The interconnectedness of these aspects reveals a rich tapestry of understanding.`,
                    
                    `For a deep dive into "${prompt.substring(0, 30)}...", we must consider: 1) Foundational principles, 2) Interdisciplinary connections, 3) Historical evolution, 4) Current state of research, 5) Practical applications, 6) Ethical considerations, and 7) Future directions. Each of these elements contributes to a holistic understanding.`
                ]
            };
            
            const modelResponses = responses[AppState.aiModel] || responses['cyanix-pro'];
            const randomResponse = modelResponses[Math.floor(Math.random() * modelResponses.length)];
            
            // Add some code examples if prompt mentions code
            if (prompt.toLowerCase().includes('code') || prompt.toLowerCase().includes('programming')) {
                const codeExample = `
\`\`\`python
# Example implementation
def example_function():
    """
    Demonstrates a clean, well-documented function.
    """
    result = 42
    return result

# Usage
print(example_function())
\`\`\`

This code shows a simple Python function with proper documentation.`;
                
                return randomResponse + '\n\n' + codeExample;
            }
            
            return randomResponse;
        }

        function speakResponse(text) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.rate = 1.0;
                utterance.pitch = 1.0;
                utterance.volume = 1.0;
                speechSynthesis.speak(utterance);
            }
        }

        function sendQuickPrompt(prompt) {
            elements.messageInput.value = prompt;
            elements.messageInput.focus();
            autoResizeInput(elements.messageInput);
        }

        // ============ UI UTILITIES ============
        function autoResizeInput(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 200) + 'px';
        }

        function handleKeyDown(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        function showSettings() {
            elements.settingsModal.classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function showPlans() {
            elements.settingsModal.classList.remove('active');
            elements.plansModal.classList.add('active');
        }

        function selectPlan(plan) {
            if (AppState.currentUser) {
                AppState.currentUser.plan = plan;
                AppState.subscription.plan = plan;
                localStorage.setItem('cyanix_user', JSON.stringify(AppState.currentUser));
                updateUIForAuth();
                
                showToast('success', 'Plan Updated', `You're now on the ${plan} plan!`);
                closeModal('plansModal');
                
                if (plan !== 'free') {
                    elements.upgradeBtn.style.display = 'none';
                }
            }
        }

        // ============ EVENT LISTENERS ============
        document.addEventListener('DOMContentLoaded', () => {
            // Check authentication
            checkAuth();
            
            // Initialize UI
            elements.aiModelSelect.value = AppState.aiModel;
            elements.creativeMode.checked = AppState.settings.creativeMode;
            elements.voiceResponses.checked = AppState.settings.voiceResponses;
            elements.darkMode.checked = AppState.settings.darkMode;
            elements.saveHistory.checked = AppState.settings.saveHistory;
            
            // Event listeners
            elements.menuToggle.addEventListener('click', () => {
                elements.sidebar.classList.toggle('active');
            });
            
            elements.newChatBtn.addEventListener('click', createNewConversation);
            
            elements.userProfile.addEventListener('click', () => {
                showSettings();
            });
            
            elements.settingsBtn.addEventListener('click', showSettings);
            
            elements.upgradeBtn.addEventListener('click', showPlans);
            
            elements.closeSettings.addEventListener('click', () => {
                closeModal('settingsModal');
            });
            
            // Auth tab switching
            elements.authTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    elements.authTabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    elements.loginForm.classList.toggle('hidden', tab.dataset.tab !== 'login');
                    elements.signupForm.classList.toggle('hidden', tab.dataset.tab !== 'signup');
                });
            });
            
            // Login form
            elements.loginForm.addEventListener('submit', (e) => {
                e.preventDefault();
                
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                
                // Simple validation
                if (!email || !password) {
                    showToast('error', 'Error', 'Please fill in all fields');
                    return;
                }
                
                // Mock authentication
                AppState.currentUser = {
                    id: 'user_' + Date.now(),
                    email: email,
                    name: 'Demo User',
                    plan: 'free',
                    createdAt: new Date().toISOString()
                };
                
                localStorage.setItem('cyanix_user', JSON.stringify(AppState.currentUser));
                
                AppState.isAuthenticated = true;
                updateUIForAuth();
                hideAuthModal();
                createNewConversation();
                
                showToast('success', 'Welcome!', 'Successfully signed in to Cyanix AI');
            });
            
            // Signup form
            elements.signupForm.addEventListener('submit', (e) => {
                e.preventDefault();
                
                const name = document.getElementById('signupName').value;
                const email = document.getElementById('signupEmail').value;
                const password = document.getElementById('signupPassword').value;
                const confirmPassword = document.getElementById('signupConfirmPassword').value;
                
                if (!name || !email || !password || !confirmPassword) {
                    showToast('error', 'Error', 'Please fill in all fields');
                    return;
                }
                
                if (password !== confirmPassword) {
                    showToast('error', 'Error', 'Passwords do not match');
                    return;
                }
                
                if (password.length < 6) {
                    showToast('error', 'Error', 'Password must be at least 6 characters');
                    return;
                }
                
                // Mock registration
                AppState.currentUser = {
                    id: 'user_' + Date.now(),
                    email: email,
                    name: name,
                    plan: 'free',
                    createdAt: new Date().toISOString()
                };
                
                localStorage.setItem('cyanix_user', JSON.stringify(AppState.currentUser));
                
                AppState.isAuthenticated = true;
                updateUIForAuth();
                hideAuthModal();
                createNewConversation();
                
                showToast('success', 'Account Created', 'Welcome to Cyanix AI!');
            });
            
            // Settings changes
            elements.aiModelSelect.addEventListener('change', (e) => {
                AppState.aiModel = e.target.value;
                elements.currentModelName.textContent = e.target.options[e.target.selectedIndex].text;
                elements.modelBadge.textContent = e.target.value.includes('pro') ? 'Pro' : 
                                                  e.target.value.includes('deep') ? 'Deep' : 'Fast';
            });
            
            elements.creativeMode.addEventListener('change', (e) => {
                AppState.settings.creativeMode = e.target.checked;
            });
            
            elements.voiceResponses.addEventListener('change', (e) => {
                AppState.settings.voiceResponses = e.target.checked;
            });
            
            elements.darkMode.addEventListener('change', (e) => {
                AppState.settings.darkMode = e.target.checked;
                document.body.classList.toggle('light-mode', !e.target.checked);
            });
            
            elements.saveHistory.addEventListener('change', (e) => {
                AppState.settings.saveHistory = e.target.checked;
            });
            
            // Close modals on overlay click
            document.querySelectorAll('.modal-overlay').forEach(overlay => {
                overlay.addEventListener('click', (e) => {
                    if (e.target === overlay) {
                        overlay.classList.remove('active');
                    }
                });
            });
            
            // PWA Installation
            let deferredPrompt;
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                
                // Show install button after 5 seconds
                setTimeout(() => {
                    if (deferredPrompt) {
                        showToast('info', 'Install Cyanix AI', 'Add to home screen for quick access');
                    }
                }, 5000);
            });
            
            // Register service worker for PWA
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('Service Worker registered:', registration);
                    })
                    .catch(error => {
                        console.log('Service Worker registration failed:', error);
                    });
            }
        });

        // ============ EXPORT FUNCTIONS FOR HTML ONCLICK ============
        window.sendMessage = sendMessage;
        window.sendQuickPrompt = sendQuickPrompt;
        window.autoResizeInput = autoResizeInput;
        window.handleKeyDown = handleKeyDown;
        window.showSettings = showSettings;
        window.showPlans = showPlans;
        window.selectPlan = selectPlan;
        window.closeModal = closeModal;
        window.showAccountDetails = () => {
            showToast('info', 'Account Details', 'This feature is coming soon!');
        };
        window.showApiConfig = () => {
            showToast('info', 'API Configuration', 'API key management will be available in the next update');
        };
    </script>
</body>
</html>